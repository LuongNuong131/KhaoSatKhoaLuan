<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Kh·∫£o S√°t - L√†ng Hoa Sa ƒê√©c | IUH Tourism Research</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: "Inter", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        position: relative;
        overflow-x: hidden;
      }
      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(
            circle at 20% 50%,
            rgba(102, 126, 234, 0.4) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 80%,
            rgba(118, 75, 162, 0.4) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 40% 20%,
            rgba(240, 147, 251, 0.3) 0%,
            transparent 40%
          );
        animation: gradientShift 20s ease infinite;
        pointer-events: none;
        z-index: 0;
      }
      @keyframes gradientShift {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.8;
          transform: scale(1.1);
        }
      }
      .glassmorphism {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }
      .card-hover {
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }
      .card-hover::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        transition: left 0.5s;
      }
      .card-hover:hover::before {
        left: 100%;
      }
      .card-hover:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      }
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-fadeInUp {
        animation: fadeInUp 0.6s ease-out forwards;
      }
      .section-title {
        position: relative;
        display: inline-block;
      }
      .section-title::after {
        content: "";
        position: absolute;
        bottom: -8px;
        left: 0;
        width: 60px;
        height: 4px;
        background: linear-gradient(90deg, #667eea, #764ba2);
        border-radius: 2px;
        animation: expandWidth 0.6s ease-out;
      }
      @keyframes expandWidth {
        from {
          width: 0;
        }
        to {
          width: 60px;
        }
      }
      .nav-btn {
        padding: 12px 24px;
        margin: 0 8px;
        border-radius: 12px;
        font-weight: 600;
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        cursor: pointer;
        border: 2px solid transparent;
        position: relative;
        overflow: hidden;
      }
      .nav-btn::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }
      .nav-btn:hover::before {
        width: 300px;
        height: 300px;
      }
      .nav-btn.active {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        box-shadow: 0 8px 24px rgba(102, 126, 234, 0.5);
        transform: scale(1.05);
      }
      .nav-btn:not(.active) {
        background: rgba(255, 255, 255, 0.25);
        color: black;
        backdrop-filter: blur(10px);
      }
      .nav-btn:not(.active):hover {
        background: rgba(255, 255, 255, 0.4);
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      }
      .section-content {
        display: none;
        animation: fadeInContent 0.5s ease-out;
      }
      @keyframes fadeInContent {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .section-content.active {
        display: block;
      }
      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        position: relative;
        overflow: hidden;
      }
      .stat-card::after {
        content: "";
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          transparent 70%
        );
        animation: rotate 20s linear infinite;
      }
      @keyframes rotate {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      .stat-card p:first-child {
        color: rgba(255, 255, 255, 0.8);
      }
      .chart-wrapper {
        position: relative;
        height: 300px;
      }
      .chart-wrapper-large {
        position: relative;
        height: 600px; /* ƒê√£ fix chi·ªÅu cao */
      }
      .progress-bar {
        background: #e5e7eb;
        border-radius: 9999px;
        height: 8px;
        overflow: hidden;
      }
      .progress-fill {
        background: linear-gradient(90deg, #667eea, #764ba2);
        height: 100%;
        transition: width 0.5s;
      }
      .max-w-7xl {
        position: relative;
        z-index: 1;
      }
      .logo-section {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        margin-bottom: 20px;
      }
      .logo-container {
        width: 80px;
        height: 80px;
        background: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s;
      }
      .logo-container:hover {
        transform: scale(1.1) rotate(5deg);
      }
      .logo-container svg {
        width: 50px;
        height: 50px;
      }
      .project-badge {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 8px 20px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 600;
        display: inline-block;
        margin-top: 10px;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }
      .info-box {
        background: linear-gradient(135deg, #f093fb, #f5576c);
        color: white;
        padding: 20px;
        border-radius: 16px;
        margin-bottom: 20px;
        box-shadow: 0 8px 24px rgba(240, 147, 251, 0.3);
      }
      .info-box h3 {
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .info-box p {
        font-size: 14px;
        line-height: 1.6;
        opacity: 0.95;
      }
      .export-btn {
        background: linear-gradient(135deg, #43e97b, #38f9d7);
        color: black;
        padding: 12px 24px;
        border-radius: 12px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        transition: all 0.3s;
        border: none;
        box-shadow: 0 4px 12px rgba(67, 233, 123, 0.4);
      }
      .export-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(67, 233, 123, 0.6);
      }
      .metric-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        border-left: 4px solid #667eea;
      }
      .metric-label {
        font-size: 13px;
        color: #6b7280;
        font-weight: 500;
        margin-bottom: 8px;
      }
      .metric-value {
        font-size: 28px;
        font-weight: 700;
        color: #1f2937;
      }
      .highlight-box {
        background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
        padding: 16px;
        border-radius: 12px;
        margin: 10px 0;
        box-shadow: 0 4px 12px rgba(253, 203, 110, 0.3);
      }
      .highlight-box p {
        color: #2d3436;
        font-weight: 600;
        margin: 0;
      }
    </style>
  </head>
  <body class="min-h-screen p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
      <header
        class="glassmorphism rounded-2xl p-8 mb-8 shadow-2xl animate-fadeInUp"
      >
        <div class="text-center">
          <div class="logo-section">
            <div class="logo-container">
              <svg viewBox="0 0 100 100" fill="none">
                <rect
                  x="10"
                  y="10"
                  width="80"
                  height="80"
                  rx="10"
                  fill="#667eea"
                />
                <text
                  x="50"
                  y="65"
                  font-size="40"
                  font-weight="bold"
                  fill="white"
                  text-anchor="middle"
                >
                  IUH
                </text>
              </svg>
            </div>

            <div class="logo-container">
              <svg viewBox="0 0 100 100" fill="none">
                <circle cx="50" cy="50" r="40" fill="#f093fb" />
                <path d="M50 30 L40 50 L50 45 L60 50 Z" fill="white" />
                <circle cx="50" cy="55" r="8" fill="white" />
                <rect x="47" y="60" width="6" height="20" fill="#38f9d7" />
              </svg>
            </div>
          </div>

          <h1
            class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-3"
          >
            Dashboard Ph√¢n T√≠ch Kh·∫£o S√°t
          </h1>
          <p class="text-gray-800 font-semibold text-xl mb-2">
            Ph√°t tri·ªÉn s·∫£n ph·∫©m du l·ªãch n√¥ng nghi·ªáp tr·∫£i nghi·ªám
          </p>
          <p class="text-gray-700 font-medium text-lg mb-3">
            üå∏ L√†ng hoa Sa ƒê√©c, t·ªânh ƒê·ªìng Th√°p üå∏
          </p>

          <div class="project-badge">
            Kh√≥a lu·∫≠n t·ªët nghi·ªáp - Khoa Th∆∞∆°ng m·∫°i - Du l·ªãch
          </div>
          <p class="text-sm text-gray-600 mt-2">
            Tr∆∞·ªùng ƒê·∫°i h·ªçc C√¥ng Nghi·ªáp TP.HCM | Kh√≥a 18 - Qu·∫£n tr·ªã d·ªãch v·ª• du
            l·ªãch v√† l·ªØ h√†nh
          </p>

          <div class="mt-6">
            <button class="export-btn" onclick="exportSummary()">
              <svg
                width="20"
                height="20"
                fill="currentColor"
                viewBox="0 0 16 16"
              >
                <path
                  d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"
                />
                <path
                  d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"
                />
              </svg>
              Xu·∫•t B√°o C√°o T√≥m T·∫Øt
            </button>
          </div>
        </div>
      </header>

      <div class="info-box animate-fadeInUp" style="animation-delay: 0.1s">
        <h3>
          <svg width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
            <path
              d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"
            />
          </svg>
          V·ªÅ Kh·∫£o S√°t N√†y
        </h3>
        <p>
          Kh·∫£o s√°t n√†y nh·∫±m thu th·∫≠p √Ω ki·∫øn c·ªßa du kh√°ch v·ªÅ m·ª©c ƒë·ªô h√†i l√≤ng v√†
          nhu c·∫ßu ph√°t tri·ªÉn c√°c s·∫£n ph·∫©m du l·ªãch n√¥ng nghi·ªáp tr·∫£i nghi·ªám t·∫°i
          L√†ng hoa Sa ƒê√©c. Nh·ªØng √Ω ki·∫øn ƒë√≥ng g√≥p qu√Ω b√°u t·ª´ du kh√°ch l√† c∆° s·ªü
          quan tr·ªçng ƒë·ªÉ ƒë·ªÅ xu·∫•t c√°c gi·∫£i ph√°p ph√°t tri·ªÉn s·∫£n ph·∫©m du l·ªãch m·ªõi,
          h·∫•p d·∫´n v√† b·ªÅn v·ªØng h∆°n.
        </p>
      </div>

      <div
        class="glassmorphism rounded-2xl p-6 mb-8 shadow-xl animate-fadeInUp"
        style="animation-delay: 0.2s"
      >
        <div class="flex flex-wrap justify-center gap-3">
          <button
            class="nav-btn active"
            onclick="showSection('overview', this)"
          >
            üìä T·ªïng quan
          </button>
          <button class="nav-btn" onclick="showSection('demographics', this)">
            üë• Nh√¢n kh·∫©u h·ªçc
          </button>
          <button class="nav-btn" onclick="showSection('behavior', this)">
            üéØ H√†nh vi du l·ªãch
          </button>
          <button class="nav-btn" onclick="showSection('satisfaction', this)">
            ‚≠ê M·ª©c ƒë·ªô h√†i l√≤ng
          </button>
          <button class="nav-btn" onclick="showSection('experience', this)">
            üå± Tr·∫£i nghi·ªám n√¥ng nghi·ªáp
          </button>
          <button class="nav-btn" onclick="showSection('future', this)">
            üöÄ D·ª± ƒë·ªãnh t∆∞∆°ng lai
          </button>
          <button class="nav-btn" onclick="showSection('feedback', this)">
            üí¨ Ph·∫£n h·ªìi & ƒê·ªÅ xu·∫•t
          </button>
        </div>
      </div>

      <div id="overview-section" class="section-content active">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          <div class="stat-card rounded-2xl p-6 shadow-xl card-hover">
            <p class="text-white/80 text-sm font-medium mb-1">T·ªïng ph·∫£n h·ªìi</p>
            <p id="totalResponses" class="text-5xl font-bold">0</p>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl card-hover">
            <p class="text-gray-600 text-sm font-medium mb-1">
              Nh√≥m tu·ªïi ph·ªï bi·∫øn
            </p>
            <p id="popularAgeGroup" class="text-5xl font-bold text-gray-800">
              N/A
            </p>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl card-hover">
            <p class="text-gray-600 text-sm font-medium mb-1">
              ƒêi·ªÉm h√†i l√≤ng TB
            </p>
            <div
              id="satisfactionRate"
              class="text-4xl font-bold text-purple-600"
            >
              <span title="ƒêi·ªÉm trung b√¨nh">0.00</span>
              <span class="text-2xl text-gray-500" title="ƒê·ªô l·ªách chu·∫©n"
                >(s=0.00)</span
              >
            </div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl card-hover">
            <p class="text-gray-600 text-sm font-medium mb-1">
              S·∫µn s√†ng quay l·∫°i
            </p>
            <p id="returnRate" class="text-5xl font-bold text-blue-600">0%</p>
          </div>
        </div>

        <div class="glassmorphism rounded-2xl p-6 shadow-xl mb-6">
          <h3 class="section-title text-xl font-bold mb-6">
            üìà Nh·ªØng Ph√°t Hi·ªán Ch√≠nh
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="metric-card">
              <div class="metric-label">Quan t√¢m tr·∫£i nghi·ªám n√¥ng nghi·ªáp</div>
              <div class="metric-value" id="expInterestPercent">0%</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">S·∫µn s√†ng gi·ªõi thi·ªáu b·∫°n b√®</div>
              <div class="metric-value" id="referralPercent">0%</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">M·ª©c gi√° ch·∫•p nh·∫≠n (trung b√¨nh)</div>
              <div class="metric-value" id="avgPrice">N/A</div>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              Top 5 Ngh·ªÅ nghi·ªáp
            </h3>
            <div id="topOccupations" class="space-y-3"></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">Top 5 N∆°i ·ªü</h3>
            <div id="topLocations" class="space-y-3"></div>
          </div>
        </div>
      </div>

      <div id="demographics-section" class="section-content">
        <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
          <div class="glassmorphism rounded-2xl p-6 shadow-xl card-hover">
            <h3 class="section-title text-xl font-bold mb-6">Gi·ªõi t√≠nh</h3>
            <div class="chart-wrapper"><canvas id="genderChart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl card-hover">
            <h3 class="section-title text-xl font-bold mb-6">ƒê·ªô tu·ªïi</h3>
            <div class="chart-wrapper"><canvas id="ageChart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl card-hover">
            <h3 class="section-title text-xl font-bold mb-6">Ngh·ªÅ nghi·ªáp</h3>
            <div class="chart-wrapper">
              <canvas id="occupationChart"></canvas>
            </div>
          </div>
          <div
            class="glassmorphism rounded-2xl p-6 shadow-xl card-hover lg:col-span-2 xl:col-span-3"
          >
            <h3 class="section-title text-xl font-bold mb-6">N∆°i ·ªü hi·ªán t·∫°i</h3>
            <div class="chart-wrapper-large">
              <canvas id="locationChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div id="behavior-section" class="section-content">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              S·ªë l·∫ßn ƒë·∫øn Sa ƒê√©c
            </h3>
            <div class="chart-wrapper">
              <canvas id="visitFrequencyChart"></canvas>
            </div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">ƒêi c√πng ai?</h3>
            <div class="chart-wrapper">
              <canvas id="companionChart"></canvas>
            </div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              H√¨nh th·ª©c du l·ªãch
            </h3>
            <div class="chart-wrapper">
              <canvas id="travelTypeChart"></canvas>
            </div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              Th·ªùi gian l∆∞u tr√∫
            </h3>
            <div class="chart-wrapper">
              <canvas id="stayDurationChart"></canvas>
            </div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl lg:col-span-2">
            <h3 class="section-title text-xl font-bold mb-6">
              K√™nh bi·∫øt ƒë·∫øn L√†ng hoa
            </h3>
            <div class="chart-wrapper-large">
              <canvas id="sourceChart"></canvas>
            </div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl lg:col-span-2">
            <h3 class="section-title text-xl font-bold mb-6">
              M·ª•c ƒë√≠ch chuy·∫øn ƒëi
            </h3>
            <div class="chart-wrapper-large">
              <canvas id="purposeChart"></canvas>
            </div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl lg:col-span-2">
            <h3 class="section-title text-xl font-bold mb-6">
              Ho·∫°t ƒë·ªông ƒë√£ tham gia
            </h3>
            <div class="chart-wrapper-large">
              <canvas id="activitiesChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div id="satisfaction-section" class="section-content">
        <div class="highlight-box mb-6">
          <p>
            üìä ƒê√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ 11 y·∫øu t·ªë t·∫°i L√†ng hoa Sa ƒê√©c (Mean &
            ƒê·ªô l·ªách chu·∫©n)
          </p>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-bold">S·ª± phong ph√∫ lo·∫°i hoa</h3>
              <div>
                <span
                  id="sat1Mean"
                  class="text-2xl font-bold text-purple-600"
                  title="ƒêi·ªÉm trung b√¨nh"
                  >0.00</span
                >
                <span
                  id="sat1StdDev"
                  class="text-lg font-medium text-gray-500"
                  title="ƒê·ªô l·ªách chu·∫©n"
                  >(s=0.00)</span
                >
              </div>
            </div>
            <div class="chart-wrapper"><canvas id="sat1Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-bold">S·ª± hi·∫øu kh√°ch</h3>
              <div>
                <span
                  id="sat2Mean"
                  class="text-2xl font-bold text-purple-600"
                  title="ƒêi·ªÉm trung b√¨nh"
                  >0.00</span
                >
                <span
                  id="sat2StdDev"
                  class="text-lg font-medium text-gray-500"
                  title="ƒê·ªô l·ªách chu·∫©n"
                  >(s=0.00)</span
                >
              </div>
            </div>
            <div class="chart-wrapper"><canvas id="sat2Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-bold">C·∫£nh quan & v·ªá sinh</h3>
              <div>
                <span
                  id="sat3Mean"
                  class="text-2xl font-bold text-purple-600"
                  title="ƒêi·ªÉm trung b√¨nh"
                  >0.00</span
                >
                <span
                  id="sat3StdDev"
                  class="text-lg font-medium text-gray-500"
                  title="ƒê·ªô l·ªách chu·∫©n"
                  >(s=0.00)</span
                >
              </div>
            </div>
            <div class="chart-wrapper"><canvas id="sat3Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-bold">Th√°i ƒë·ªô nh√¢n vi√™n</h3>
              <div>
                <span
                  id="sat4Mean"
                  class="text-2xl font-bold text-purple-600"
                  title="ƒêi·ªÉm trung b√¨nh"
                  >0.00</span
                >
                <span
                  id="sat4StdDev"
                  class="text-lg font-medium text-gray-500"
                  title="ƒê·ªô l·ªách chu·∫©n"
                  >(s=0.00)</span
                >
              </div>
            </div>
            <div class="chart-wrapper"><canvas id="sat4Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-bold">C∆° s·ªü h·∫° t·∫ßng</h3>
              <div>
                <span
                  id="sat5Mean"
                  class="text-2xl font-bold text-purple-600"
                  title="ƒêi·ªÉm trung b√¨nh"
                  >0.00</span
                >
                <span
                  id="sat5StdDev"
                  class="text-lg font-medium text-gray-500"
                  title="ƒê·ªô l·ªách chu·∫©n"
                  >(s=0.00)</span
                >
              </div>
            </div>
            <div class="chart-wrapper"><canvas id="sat5Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-bold">N√©t ƒë·ªôc ƒë√°o</h3>
              <div>
                <span
                  id="sat6Mean"
                  class="text-2xl font-bold text-purple-600"
                  title="ƒêi·ªÉm trung b√¨nh"
                  >0.00</span
                >
                <span
                  id="sat6StdDev"
                  class="text-lg font-medium text-gray-500"
                  title="ƒê·ªô l·ªách chu·∫©n"
                  >(s=0.00)</span
                >
              </div>
            </div>
            <div class="chart-wrapper"><canvas id="sat6Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-bold">Ch·∫•t l∆∞·ª£ng d·ªãch v·ª•</h3>
              <div>
                <span
                  id="sat7Mean"
                  class="text-2xl font-bold text-purple-600"
                  title="ƒêi·ªÉm trung b√¨nh"
                  >0.00</span
                >
                <span
                  id="sat7StdDev"
                  class="text-lg font-medium text-gray-500"
                  title="ƒê·ªô l·ªách chu·∫©n"
                  >(s=0.00)</span
                >
              </div>
            </div>
            <div class="chart-wrapper"><canvas id="sat7Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-bold">Gi√° c·∫£ d·ªãch v·ª•</h3>
              <div>
                <span
                  id="sat8Mean"
                  class="text-2xl font-bold text-purple-600"
                  title="ƒêi·ªÉm trung b√¨nh"
                  >0.00</span
                >
                <span
                  id="sat8StdDev"
                  class="text-lg font-medium text-gray-500"
                  title="ƒê·ªô l·ªách chu·∫©n"
                  >(s=0.00)</span
                >
              </div>
            </div>
            <div class="chart-wrapper"><canvas id="sat8Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-bold">S·ª± an to√†n</h3>
              <div>
                <span
                  id="sat9Mean"
                  class="text-2xl font-bold text-purple-600"
                  title="ƒêi·ªÉm trung b√¨nh"
                  >0.00</span
                >
                <span
                  id="sat9StdDev"
                  class="text-lg font-medium text-gray-500"
                  title="ƒê·ªô l·ªách chu·∫©n"
                  >(s=0.00)</span
                >
              </div>
            </div>
            <div class="chart-wrapper"><canvas id="sat9Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-bold">ƒêa d·∫°ng ho·∫°t ƒë·ªông</h3>
              <div>
                <span
                  id="sat10Mean"
                  class="text-2xl font-bold text-purple-600"
                  title="ƒêi·ªÉm trung b√¨nh"
                  >0.00</span
                >
                <span
                  id="sat10StdDev"
                  class="text-lg font-medium text-gray-500"
                  title="ƒê·ªô l·ªách chu·∫©n"
                  >(s=0.00)</span
                >
              </div>
            </div>
            <div class="chart-wrapper"><canvas id="sat10Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-bold">T√≠nh k·∫øt n·ªëi tour</h3>
              <div>
                <span
                  id="sat11Mean"
                  class="text-2xl font-bold text-purple-600"
                  title="ƒêi·ªÉm trung b√¨nh"
                  >0.00</span
                >
                <span
                  id="sat11StdDev"
                  class="text-lg font-medium text-gray-500"
                  title="ƒê·ªô l·ªách chu·∫©n"
                  >(s=0.00)</span
                >
              </div>
            </div>
            <div class="chart-wrapper"><canvas id="sat11Chart"></canvas></div>
          </div>
        </div>
      </div>

      <div id="experience-section" class="section-content">
        <div class="highlight-box mb-6">
          <p>
            üå± Nhu c·∫ßu v√† k·ª≥ v·ªçng v·ªÅ ph√°t tri·ªÉn du l·ªãch n√¥ng nghi·ªáp tr·∫£i nghi·ªám
          </p>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              Quan t√¢m tr·∫£i nghi·ªám n√¥ng nghi·ªáp? (C√¢u 13)
            </h3>
            <div class="chart-wrapper">
              <canvas id="expInterestChart"></canvas>
            </div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              M·ª©c chi tr·∫£ mong mu·ªën (C√¢u 15)
            </h3>
            <div class="chart-wrapper">
              <canvas id="priceRangeChart"></canvas>
            </div>
          </div>

          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              üìä ƒêi·ªÉm quan t√¢m TB (C√¢u 14)
            </h3>
            <div
              id="interestMeanList"
              class="space-y-3 max-h-[300px] overflow-y-auto pr-2"
            ></div>
          </div>

          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              Y·∫øu t·ªë thu h√∫t tham gia (C√¢u 16)
            </h3>
            <div class="chart-wrapper-large" style="height: 400px">
              <canvas id="attractionFactorsChart"></canvas>
            </div>
          </div>

          <div class="glassmorphism rounded-2xl p-6 shadow-xl lg:col-span-2">
            <h3 class="section-title text-xl font-bold mb-6">
              Y·∫øu t·ªë c·∫ßn c·∫£i thi·ªán (C√¢u 17)
            </h3>
            <div class="chart-wrapper-large" style="height: 400px">
              <canvas id="improvementChart"></canvas>
            </div>
          </div>

          <div
            class="glassmorphism rounded-2xl p-6 shadow-xl lg:col-span-2 mt-6"
          >
            <h3 class="section-title text-xl font-bold mb-6">
              Chi ti·∫øt M·ª©c ƒë·ªô Quan t√¢m (C√¢u 14)
            </h3>
            <div
              class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6 mt-12"
            >
              <div class="glassmorphism rounded-2xl p-4 shadow-lg">
                <div class="flex justify-between items-center mb-4">
                  <h3 class="text-md font-bold">Tour xe ƒë·∫°p/xe ƒëi·ªán</h3>
                  <div>
                    <span
                      id="int1Mean"
                      class="text-xl font-bold text-purple-600"
                      title="ƒêi·ªÉm trung b√¨nh"
                      >0.00</span
                    >
                    <span
                      id="int1StdDev"
                      class="text-md font-medium text-gray-500"
                      title="ƒê·ªô l·ªách chu·∫©n"
                      >(s=0.00)</span
                    >
                  </div>
                </div>
                <div class="chart-wrapper" style="height: 250px">
                  <canvas id="int1Chart"></canvas>
                </div>
              </div>
              <div class="glassmorphism rounded-2xl p-4 shadow-lg">
                <div class="flex justify-between items-center mb-4">
                  <h3 class="text-md font-bold">"M·ªôt ng√†y l√†m n√¥ng d√¢n"</h3>
                  <div>
                    <span
                      id="int2Mean"
                      class="text-xl font-bold text-purple-600"
                      title="ƒêi·ªÉm trung b√¨nh"
                      >0.00</span
                    >
                    <span
                      id="int2StdDev"
                      class="text-md font-medium text-gray-500"
                      title="ƒê·ªô l·ªách chu·∫©n"
                      >(s=0.00)</span
                    >
                  </div>
                </div>
                <div class="chart-wrapper" style="height: 250px">
                  <canvas id="int2Chart"></canvas>
                </div>
              </div>
              <div class="glassmorphism rounded-2xl p-4 shadow-lg">
                <div class="flex justify-between items-center mb-4">
                  <h3 class="text-md font-bold">Workshop c·∫Øm hoa/bonsai</h3>
                  <div>
                    <span
                      id="int3Mean"
                      class="text-xl font-bold text-purple-600"
                      title="ƒêi·ªÉm trung b√¨nh"
                      >0.00</span
                    >
                    <span
                      id="int3StdDev"
                      class="text-md font-medium text-gray-500"
                      title="ƒê·ªô l·ªách chu·∫©n"
                      >(s=0.00)</span
                    >
                  </div>
                </div>
                <div class="chart-wrapper" style="height: 250px">
                  <canvas id="int3Chart"></canvas>
                </div>
              </div>
              <div class="glassmorphism rounded-2xl p-4 shadow-lg">
                <div class="flex justify-between items-center mb-4">
                  <h3 class="text-md font-bold">L·ªõp h·ªçc n·∫•u ƒÉn/l√†m b√°nh</h3>
                  <div>
                    <span
                      id="int4Mean"
                      class="text-xl font-bold text-purple-600"
                      title="ƒêi·ªÉm trung b√¨nh"
                      >0.00</span
                    >
                    <span
                      id="int4StdDev"
                      class="text-md font-medium text-gray-500"
                      title="ƒê·ªô l·ªách chu·∫©n"
                      >(s=0.00)</span
                    >
                  </div>
                </div>
                <div class="chart-wrapper" style="height: 250px">
                  <canvas id="int4Chart"></canvas>
                </div>
              </div>
              <div class="glassmorphism rounded-2xl p-4 shadow-lg">
                <div class="flex justify-between items-center mb-4">
                  <h3 class="text-md font-bold">
                    Workshop th·ªß c√¥ng (n·∫øn, tr√†)
                  </h3>
                  <div>
                    <span
                      id="int5Mean"
                      class="text-xl font-bold text-purple-600"
                      title="ƒêi·ªÉm trung b√¨nh"
                      >0.00</span
                    >
                    <span
                      id="int5StdDev"
                      class="text-md font-medium text-gray-500"
                      title="ƒê·ªô l·ªách chu·∫©n"
                      >(s=0.00)</span
                    >
                  </div>
                </div>
                <div class="chart-wrapper" style="height: 250px">
                  <canvas id="int5Chart"></canvas>
                </div>
              </div>
              <div class="glassmorphism rounded-2xl p-4 shadow-lg">
                <div class="flex justify-between items-center mb-4">
                  <h3 class="text-md font-bold">Ho·∫°t ƒë·ªông s√¥ng n∆∞·ªõc</h3>
                  <div>
                    <span
                      id="int6Mean"
                      class="text-xl font-bold text-purple-600"
                      title="ƒêi·ªÉm trung b√¨nh"
                      >0.00</span
                    >
                    <span
                      id="int6StdDev"
                      class="text-md font-medium text-gray-500"
                      title="ƒê·ªô l·ªách chu·∫©n"
                      >(s=0.00)</span
                    >
                  </div>
                </div>
                <div class="chart-wrapper" style="height: 250px">
                  <canvas id="int6Chart"></canvas>
                </div>
              </div>
              <div class="glassmorphism rounded-2xl p-4 shadow-lg">
                <div class="flex justify-between items-center mb-4">
                  <h3 class="text-md font-bold">L∆∞u tr√∫ Homestay</h3>
                  <div>
                    <span
                      id="int7Mean"
                      class="text-xl font-bold text-purple-600"
                      title="ƒêi·ªÉm trung b√¨nh"
                      >0.00</span
                    >
                    <span
                      id="int7StdDev"
                      class="text-md font-medium text-gray-500"
                      title="ƒê·ªô l·ªách chu·∫©n"
                      >(s=0.00)</span
                    >
                  </div>
                </div>
                <div class="chart-wrapper" style="height: 250px">
                  <canvas id="int7Chart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="future-section" class="section-content">
        <div class="highlight-box mb-6">
          <p>üöÄ D·ª± ƒë·ªãnh v√† cam k·∫øt c·ªßa du kh√°ch v·ªõi L√†ng hoa Sa ƒê√©c</p>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              Gi·ªõi thi·ªáu b·∫°n b√®? (C√¢u 18)
            </h3>
            <div class="chart-wrapper">
              <canvas id="referralChart"></canvas>
            </div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              D·ª± ƒë·ªãnh quay l·∫°i? (C√¢u 19)
            </h3>
            <div class="chart-wrapper"><canvas id="returnChart"></canvas></div>
          </div>
        </div>
      </div>

      <div id="feedback-section" class="section-content">
        <div class="highlight-box mb-6">
          <p>üí¨ C·∫£m nh·∫≠n th·ª±c t·∫ø v√† ƒë·ªÅ xu·∫•t ph√°t tri·ªÉn t·ª´ du kh√°ch</p>
        </div>
        <div class="grid grid-cols-1 gap-6">
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              Danh s√°ch C·∫£m nh·∫≠n (C√¢u 20) & ƒê·ªÅ xu·∫•t (C√¢u 21)
            </h3>
            <div
              id="feedbackListBox"
              class="space-y-4 max-h-[600px] overflow-y-auto pr-2"
            ></div>
          </div>
        </div>
      </div>

      <footer class="mt-8 glassmorphism rounded-2xl p-6 text-center shadow-xl">
        <p class="text-gray-700 font-semibold mb-2">
          ¬© 2025 Kh√≥a lu·∫≠n t·ªët nghi·ªáp - Khoa Th∆∞∆°ng m·∫°i - Du l·ªãch
        </p>
        <p class="text-gray-600 text-sm mb-2">
          Tr∆∞·ªùng ƒê·∫°i h·ªçc C√¥ng Nghi·ªáp Th√†nh ph·ªë H·ªì Ch√≠ Minh
        </p>
        <p class="text-gray-500 text-xs">
          Dashboard ph√°t tri·ªÉn b·ªüi nh√≥m sinh vi√™n Kh√≥a 18 - Qu·∫£n tr·ªã d·ªãch v·ª• du
          l·ªãch v√† l·ªØ h√†nh
        </p>
      </footer>
    </div>

    <script>
      // ===================================================================
      // PH·∫¶N 1: N·∫†P V√Ä X·ª¨ L√ù D·ªÆ LI·ªÜU
      // ===================================================================
      const charts = {};
      const colors = [
        "#667eea",
        "#764ba2",
        "#f093fb",
        "#4facfe",
        "#43e97b",
        "#fa709a",
        "#fee140",
        "#30cfd0",
        "#a8edea",
        "#fed6e3",
      ];
      let globalData = [];
      let columnMapping = {};

      const scoreMap = {
        // Thang ƒëi·ªÉm H√†i l√≤ng (C√¢u 12)
        "r·∫•t kh√¥ng h√†i l√≤ng": 1,
        "kh√¥ng h√†i l√≤ng": 2,
        "b√¨nh th∆∞·ªùng": 3,
        "h√†i l√≤ng": 4,
        "r·∫•t h√†i l√≤ng": 5,

        // Thang ƒëi·ªÉm Quan t√¢m (C√¢u 14)
        "ho√†n to√†n kh√¥ng quan t√¢m": 1,
        "kh√¥ng quan t√¢m": 2,
        // "b√¨nh th∆∞·ªùng" ƒë√£ l√† 3
        "quan t√¢m": 4,
        "r·∫•t quan t√¢m": 5,

        // Thang ƒëi·ªÉm d·∫°ng S·ªë (C√¢u 13, 18)
        1: 1,
        2: 2,
        3: 3,
        4: 4,
        5: 5,
      };

      document.addEventListener("DOMContentLoaded", loadData);

      async function loadData() {
        try {
          console.log("ƒêang t·∫£i d·ªØ li·ªáu t·ª´ data.json...");
          const response = await fetch("data.json"); // ƒê·ªçc file data.json

          if (!response.ok) {
            throw new Error(
              `HTTP error! status: ${response.status}. Kh√¥ng t√¨m th·∫•y file data.json?`
            );
          }

          const rawData = await response.json();
          console.log("D·ªØ li·ªáu th√¥:", rawData);

          if (Array.isArray(rawData)) {
            console.log("‚úì ƒê·ªãnh d·∫°ng: Array");
            console.log("S·ªë d√≤ng:", rawData.length);

            if (rawData.length < 2) {
              throw new Error(
                "File data.json kh√¥ng c√≥ d·ªØ li·ªáu (ch·ªâ c√≥ header)!"
              );
            }

            columnMapping = rawData[0];
            console.log("Column mapping:", columnMapping);

            globalData = rawData
              .slice(1)
              .map((row) => {
                const newRow = {};
                for (const key in row) {
                  if (columnMapping[key]) {
                    newRow[columnMapping[key]] = row[key];
                  }
                }
                return newRow;
              })
              .filter((row) =>
                Object.values(row).some(
                  (v) => v !== "" && v !== null && v !== undefined
                )
              );
          } else {
            throw new Error("ƒê·ªãnh d·∫°ng data.json kh√¥ng h·ª£p l·ªá!");
          }

          console.log("D·ªØ li·ªáu ƒë√£ x·ª≠ l√Ω:", globalData);
          console.log("S·ªë b·∫£n ghi h·ª£p l·ªá:", globalData.length);

          if (globalData.length === 0) {
            alert("‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu! Vui l√≤ng ki·ªÉm tra l·∫°i file data.json");
          }

          processAllData();
          console.log("‚úÖ T·∫£i d·ªØ li·ªáu th√†nh c√¥ng!");
        } catch (error) {
          console.error("‚ùå L·ªói chi ti·∫øt:", error);
          alert(
            `Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu!\n\nL·ªói: ${error.message}\n\nH√£y ƒë·∫£m b·∫£o file 'data.json' n·∫±m c√πng th∆∞ m·ª•c v·ªõi file HTML n√†y.`
          );
        }
      }

      function smartSplitAnswers(text) {
        if (!text) return [];
        const parts = text.split(",");
        const results = [];
        let currentAnswer = "";

        for (let i = 0; i < parts.length; i++) {
          const part = parts[i].trim();
          if (!part) continue;
          if (currentAnswer === "") {
            currentAnswer = part;
          } else {
            const firstChar = part.charAt(0);
            const isUpperCase =
              firstChar === firstChar.toUpperCase() &&
              firstChar !== firstChar.toLowerCase();
            if (isUpperCase && part.length > 3) {
              results.push(currentAnswer);
              currentAnswer = part;
            } else {
              currentAnswer += ", " + part;
            }
          }
        }
        if (currentAnswer) {
          results.push(currentAnswer);
        }
        return results.filter((item) => item && item.length > 0);
      }

      // ===================================================================
      // PH·∫¶N 2: C√ÅC H√ÄM T√çNH TO√ÅN (MEAN V√Ä ƒê·ªò L·ªÜCH CHU·∫®N)
      // ===================================================================

      function getMeanScore(data, colName) {
        let totalScore = 0;
        let count = 0;
        if (!colName) return 0;
        data.forEach((row) => {
          const val = String(row[colName] || "")
            .trim()
            .toLowerCase();
          const score = scoreMap[val];
          if (score) {
            totalScore += score;
            count++;
          }
        });
        return count > 0 ? totalScore / count : 0;
      }

      /**
       * T√≠nh ƒê·ªô l·ªách chu·∫©n M·∫´u (s)
       * s = sqrt( (sum[ f * (x_i - mean)^2 ]) / (n-1) )
       */
      function getStandardDeviation(data, colName, mean) {
        if (!colName || mean === 0) return 0;

        let sumOfSquaredDeviations = 0;
        let n = 0; // n l√† s·ªë l∆∞·ª£ng c√¢u tr·∫£ l·ªùi H·ª¢P L·ªÜ

        data.forEach((row) => {
          const val = String(row[colName] || "")
            .trim()
            .toLowerCase();
          const score = scoreMap[val];
          if (score) {
            const deviation = score - mean;
            sumOfSquaredDeviations += deviation * deviation;
            n++;
          }
        });

        if (n <= 1) return 0; // C·∫ßn √≠t nh·∫•t 2 m·∫´u

        const variance = sumOfSquaredDeviations / (n - 1); // Chia cho n-1
        return Math.sqrt(variance);
      }

      // ===================================================================
      // PH·∫¶N 3: H√ÄM X·ª¨ L√ù CH√çNH (G·ªåI T·∫§T C·∫¢ PH√ÇN T√çCH)
      // ===================================================================

      function processAllData() {
        const d = globalData;
        document.getElementById("totalResponses").textContent = d.length;

        if (d.length === 0) {
          console.warn("Kh√¥ng c√≥ d·ªØ li·ªáu kh·∫£o s√°t ƒë·ªÉ x·ª≠ l√Ω.");
          document.getElementById("popularAgeGroup").textContent = "N/A";
          return;
        }

        // ================================================
        // B·∫ÆT ƒê·∫¶U PH·∫¶N S·ª¨A L·ªñI LOGIC
        // ================================================

        // L·∫•y t√™n c·ªôt m·ªôt c√°ch an to√†n
        const ageCol = getColumnByLetter("C");
        const returnCol = getColumnByLetter("AJ");
        const expCol = getColumnByLetter("X");
        const refCol = getColumnByLetter("AI");
        const priceCol = getColumnByLetter("AF");
        const occupationCol = getColumnByLetter("E");
        const locationCol = getColumnByLetter("D");

        const ageCounts = {};
        d.forEach((row) => {
          // ƒê√£ s·ª≠a: D√πng ageCol thay v√¨ hardcode "2. ƒê·ªô tu·ªïi:"
          const ageGroup = row[ageCol];
          if (ageGroup) ageCounts[ageGroup] = (ageCounts[ageGroup] || 0) + 1;
        });

        let popularAgeGroup = "N/A",
          maxCount = 0;
        for (const ageGroup in ageCounts) {
          if (ageCounts[ageGroup] > maxCount) {
            maxCount = ageCounts[ageGroup];
            popularAgeGroup = ageGroup;
          }
        }
        document.getElementById("popularAgeGroup").textContent =
          popularAgeGroup;

        // T√≠nh Mean v√† SD t·ªïng th·ªÉ (C√¢u 12) - Ph·∫ßn n√†y ƒë√£ ƒë√∫ng
        const satKeys = ["M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W"];
        let overallTotalScore = 0;
        let overallCount = 0;

        satKeys.forEach((letter) => {
          const colName = getColumnByLetter(letter);
          if (colName) {
            d.forEach((row) => {
              const val = String(row[colName] || "")
                .trim()
                .toLowerCase();
              const score = scoreMap[val];
              if (score) {
                overallTotalScore += score;
                overallCount++;
              }
            });
          }
        });

        const overallMean =
          overallCount > 0 ? overallTotalScore / overallCount : 0;

        let overallSumSqDev = 0;
        satKeys.forEach((letter) => {
          const colName = getColumnByLetter(letter);
          if (colName) {
            d.forEach((row) => {
              const val = String(row[colName] || "")
                .trim()
                .toLowerCase();
              const score = scoreMap[val];
              if (score) {
                const deviation = score - overallMean;
                overallSumSqDev += deviation * deviation;
              }
            });
          }
        });

        const overallVariance =
          overallCount > 1 ? overallSumSqDev / (overallCount - 1) : 0;
        const overallStdDev = Math.sqrt(overallVariance);

        document.getElementById("satisfactionRate").innerHTML = `
            <span title="ƒêi·ªÉm trung b√¨nh">${overallMean.toFixed(2)}</span>
            <span class="text-2xl text-gray-500" title="ƒê·ªô l·ªách chu·∫©n">(s=${overallStdDev.toFixed(
              2
            )})</span>
          `;

        // Ph√¢n t√≠ch c√°c th·∫ª th·ªëng k√™ kh√°c
        const returnYes = d.filter((row) => {
          // ƒê√£ s·ª≠a: D√πng returnCol
          const val = row[returnCol];
          if (!val) return false;
          const valLower = String(val).toLowerCase();
          return valLower.includes("c√≥") || valLower.includes("ch·∫Øc ch·∫Øn");
        }).length;
        const returnRate = ((returnYes / d.length) * 100).toFixed(1);
        document.getElementById("returnRate").textContent = returnRate + "%";

        const expYes = d.filter((row) => {
          // ƒê√£ s·ª≠a: D√πng expCol
          const val = row[expCol];
          if (!val) return false;
          const valLower = String(val).toLowerCase();
          return (
            valLower.includes("quan t√¢m") ||
            valLower.includes("r·∫•t") ||
            valLower === "4" ||
            valLower === "5"
          );
        }).length;
        const expRate = ((expYes / d.length) * 100).toFixed(1);
        document.getElementById("expInterestPercent").textContent =
          expRate + "%";

        const refYes = d.filter((row) => {
          // ƒê√£ s·ª≠a: D√πng refCol
          const val = row[refCol];
          if (!val) return false;
          const valLower = String(val).toLowerCase();
          return (
            valLower.includes("c√≥") || valLower === "4" || valLower === "5"
          );
        }).length;
        const refRate = ((refYes / d.length) * 100).toFixed(1);
        document.getElementById("referralPercent").textContent = refRate + "%";

        const priceRanges = {
          "100.000 - 200.000 vnƒë": 150000,
          "200.000 - 300.000 vnƒë": 250000,
          "tr√™n 300.000 vnƒë": 350000,
          "d∆∞·ªõi 100.000 vnƒë": 80000,
        };
        let totalPrice = 0,
          priceCount = 0;
        d.forEach((row) => {
          // ƒê√£ s·ª≠a: D√πng priceCol
          const val = String(row[priceCol] || "").toLowerCase();
          if (val && priceRanges[val]) {
            totalPrice += priceRanges[val];
            priceCount++;
          }
        });
        const avgPrice =
          priceCount > 0 ? Math.round(totalPrice / priceCount) : 0;
        document.getElementById("avgPrice").textContent =
          avgPrice > 0 ? (avgPrice / 1000).toFixed(0) + "K VNƒê" : "N/A";

        // V·∫Ω bi·ªÉu ƒë·ªì
        // ƒê√£ s·ª≠a: D√πng t√™n c·ªôt ƒë√£ l·∫•y
        renderTopList(d, occupationCol, "topOccupations");
        renderTopList(d, locationCol, "topLocations");

        // ================================================
        // K·∫æT TH√öC PH·∫¶N S·ª¨A L·ªñI LOGIC
        // ================================================

        renderPieChart(d, "B", "genderChart", "doughnut");
        renderBarChart(d, "C", "ageChart");
        renderBarChart(d, "E", "occupationChart", true);
        renderBarChart(d, "D", "locationChart", true);

        renderPieChart(d, "F", "visitFrequencyChart", "pie");
        renderPieChart(d, "H", "companionChart", "doughnut");
        renderPieChart(d, "J", "travelTypeChart", "polarArea");
        renderBarChart(d, "K", "stayDurationChart");
        renderMultiChart(d, "G", "sourceChart");
        renderMultiChart(d, "I", "purposeChart");
        renderMultiChart(d, "L", "activitiesChart");

        const satOrder = [
          "R·∫•t h√†i l√≤ng",
          "H√†i l√≤ng",
          "B√¨nh th∆∞·ªùng",
          "Kh√¥ng h√†i l√≤ng",
          "R·∫•t kh√¥ng h√†i l√≤ng",
        ];

        // T√≠nh Mean & SD cho C√¢u 12
        const meanM = getMeanScore(d, getColumnByLetter("M"));
        const stdDevM = getStandardDeviation(d, getColumnByLetter("M"), meanM);
        document.getElementById("sat1Mean").textContent = meanM.toFixed(2);
        document.getElementById(
          "sat1StdDev"
        ).textContent = `(s=${stdDevM.toFixed(2)})`;
        renderOrderedChart(d, "M", "sat1Chart", satOrder);

        const meanN = getMeanScore(d, getColumnByLetter("N"));
        const stdDevN = getStandardDeviation(d, getColumnByLetter("N"), meanN);
        document.getElementById("sat2Mean").textContent = meanN.toFixed(2);
        document.getElementById(
          "sat2StdDev"
        ).textContent = `(s=${stdDevN.toFixed(2)})`;
        renderOrderedChart(d, "N", "sat2Chart", satOrder);

        const meanO = getMeanScore(d, getColumnByLetter("O"));
        const stdDevO = getStandardDeviation(d, getColumnByLetter("O"), meanO);
        document.getElementById("sat3Mean").textContent = meanO.toFixed(2);
        document.getElementById(
          "sat3StdDev"
        ).textContent = `(s=${stdDevO.toFixed(2)})`;
        renderOrderedChart(d, "O", "sat3Chart", satOrder);

        const meanP = getMeanScore(d, getColumnByLetter("P"));
        const stdDevP = getStandardDeviation(d, getColumnByLetter("P"), meanP);
        document.getElementById("sat4Mean").textContent = meanP.toFixed(2);
        document.getElementById(
          "sat4StdDev"
        ).textContent = `(s=${stdDevP.toFixed(2)})`;
        renderOrderedChart(d, "P", "sat4Chart", satOrder);

        const meanQ = getMeanScore(d, getColumnByLetter("Q"));
        const stdDevQ = getStandardDeviation(d, getColumnByLetter("Q"), meanQ);
        document.getElementById("sat5Mean").textContent = meanQ.toFixed(2);
        document.getElementById(
          "sat5StdDev"
        ).textContent = `(s=${stdDevQ.toFixed(2)})`;
        renderOrderedChart(d, "Q", "sat5Chart", satOrder);

        const meanR = getMeanScore(d, getColumnByLetter("R"));
        const stdDevR = getStandardDeviation(d, getColumnByLetter("R"), meanR);
        document.getElementById("sat6Mean").textContent = meanR.toFixed(2);
        document.getElementById(
          "sat6StdDev"
        ).textContent = `(s=${stdDevR.toFixed(2)})`;
        renderOrderedChart(d, "R", "sat6Chart", satOrder);

        const meanS = getMeanScore(d, getColumnByLetter("S"));
        const stdDevS = getStandardDeviation(d, getColumnByLetter("S"), meanS);
        document.getElementById("sat7Mean").textContent = meanS.toFixed(2);
        document.getElementById(
          "sat7StdDev"
        ).textContent = `(s=${stdDevS.toFixed(2)})`;
        renderOrderedChart(d, "S", "sat7Chart", satOrder);

        const meanT = getMeanScore(d, getColumnByLetter("T"));
        const stdDevT = getStandardDeviation(d, getColumnByLetter("T"), meanT);
        document.getElementById("sat8Mean").textContent = meanT.toFixed(2);
        document.getElementById(
          "sat8StdDev"
        ).textContent = `(s=${stdDevT.toFixed(2)})`;
        renderOrderedChart(d, "T", "sat8Chart", satOrder);

        const meanU = getMeanScore(d, getColumnByLetter("U"));
        const stdDevU = getStandardDeviation(d, getColumnByLetter("U"), meanU);
        document.getElementById("sat9Mean").textContent = meanU.toFixed(2);
        document.getElementById(
          "sat9StdDev"
        ).textContent = `(s=${stdDevU.toFixed(2)})`;
        renderOrderedChart(d, "U", "sat9Chart", satOrder);

        const meanV = getMeanScore(d, getColumnByLetter("V"));
        const stdDevV = getStandardDeviation(d, getColumnByLetter("V"), meanV);
        document.getElementById("sat10Mean").textContent = meanV.toFixed(2);
        document.getElementById(
          "sat10StdDev"
        ).textContent = `(s=${stdDevV.toFixed(2)})`;
        renderOrderedChart(d, "V", "sat10Chart", satOrder);

        const meanW = getMeanScore(d, getColumnByLetter("W"));
        const stdDevW = getStandardDeviation(d, getColumnByLetter("W"), meanW);
        document.getElementById("sat11Mean").textContent = meanW.toFixed(2);
        document.getElementById(
          "sat11StdDev"
        ).textContent = `(s=${stdDevW.toFixed(2)})`;
        renderOrderedChart(d, "W", "sat11Chart", satOrder);

        // Bi·ªÉu ƒë·ªì Tr·∫£i nghi·ªám (C√¢u 13)
        const interestMapping = {
          5: "R·∫•t quan t√¢m",
          4: "Quan t√¢m",
          3: "B√¨nh th∆∞·ªùng",
          2: "Kh√¥ng quan t√¢m",
          1: "Ho√†n to√†n kh√¥ng quan t√¢m",
        };
        renderMappedPieChart(
          d,
          "X",
          "expInterestChart",
          "doughnut",
          interestMapping
        );
        renderBarChart(d, "AF", "priceRangeChart");

        // B·∫£ng Mean & SD cho C√¢u 14
        const interestCols = ["Y", "Z", "AA", "AB", "AC", "AD", "AE"];
        renderMeanList(d, interestCols, "interestMeanList");

        // ==================================================
        // START FIX: V·∫º 7 BI·ªÇU ƒê·ªí CHI TI·∫æT CHO C√ÇU 14
        // ==================================================
        const interestOrder = [
          "R·∫•t quan t√¢m",
          "Quan t√¢m",
          "B√¨nh th∆∞·ªùng",
          "Kh√¥ng quan t√¢m",
          "Ho√†n to√†n kh√¥ng quan t√¢m",
        ];

        const meanY = getMeanScore(d, getColumnByLetter("Y"));
        const stdDevY = getStandardDeviation(d, getColumnByLetter("Y"), meanY);
        document.getElementById("int1Mean").textContent = meanY.toFixed(2);
        document.getElementById(
          "int1StdDev"
        ).textContent = `(s=${stdDevY.toFixed(2)})`;
        renderOrderedChart(d, "Y", "int1Chart", interestOrder);

        const meanZ = getMeanScore(d, getColumnByLetter("Z"));
        const stdDevZ = getStandardDeviation(d, getColumnByLetter("Z"), meanZ);
        document.getElementById("int2Mean").textContent = meanZ.toFixed(2);
        document.getElementById(
          "int2StdDev"
        ).textContent = `(s=${stdDevZ.toFixed(2)})`;
        renderOrderedChart(d, "Z", "int2Chart", interestOrder);

        const meanAA = getMeanScore(d, getColumnByLetter("AA"));
        const stdDevAA = getStandardDeviation(
          d,
          getColumnByLetter("AA"),
          meanAA
        );
        document.getElementById("int3Mean").textContent = meanAA.toFixed(2);
        document.getElementById(
          "int3StdDev"
        ).textContent = `(s=${stdDevAA.toFixed(2)})`;
        renderOrderedChart(d, "AA", "int3Chart", interestOrder);

        const meanAB = getMeanScore(d, getColumnByLetter("AB"));
        const stdDevAB = getStandardDeviation(
          d,
          getColumnByLetter("AB"),
          meanAB
        );
        document.getElementById("int4Mean").textContent = meanAB.toFixed(2);
        document.getElementById(
          "int4StdDev"
        ).textContent = `(s=${stdDevAB.toFixed(2)})`;
        renderOrderedChart(d, "AB", "int4Chart", interestOrder);

        const meanAC = getMeanScore(d, getColumnByLetter("AC"));
        const stdDevAC = getStandardDeviation(
          d,
          getColumnByLetter("AC"),
          meanAC
        );
        document.getElementById("int5Mean").textContent = meanAC.toFixed(2);
        document.getElementById(
          "int5StdDev"
        ).textContent = `(s=${stdDevAC.toFixed(2)})`;
        renderOrderedChart(d, "AC", "int5Chart", interestOrder);

        const meanAD = getMeanScore(d, getColumnByLetter("AD"));
        const stdDevAD = getStandardDeviation(
          d,
          getColumnByLetter("AD"),
          meanAD
        );
        document.getElementById("int6Mean").textContent = meanAD.toFixed(2);
        document.getElementById(
          "int6StdDev"
        ).textContent = `(s=${stdDevAD.toFixed(2)})`;
        renderOrderedChart(d, "AD", "int6Chart", interestOrder);

        const meanAE = getMeanScore(d, getColumnByLetter("AE"));
        const stdDevAE = getStandardDeviation(
          d,
          getColumnByLetter("AE"),
          meanAE
        );
        document.getElementById("int7Mean").textContent = meanAE.toFixed(2);
        document.getElementById(
          "int7StdDev"
        ).textContent = `(s=${stdDevAE.toFixed(2)})`;
        renderOrderedChart(d, "AE", "int7Chart", interestOrder);
        // ==================================================
        // END FIX
        // ==================================================

        renderMultiChart(d, "AG", "attractionFactorsChart");
        renderMultiChart(d, "AH", "improvementChart");

        // Bi·ªÉu ƒë·ªì C√¢u 18
        const referralMapping = {
          5: "R·∫•t s·∫µn l√≤ng",
          4: "S·∫µn l√≤ng",
          3: "B√¨nh th∆∞·ªùng",
          2: "Kh√¥ng s·∫µn l√≤ng",
          1: "Ch·∫Øc ch·∫Øn kh√¥ng",
        };
        renderMappedPieChart(
          d,
          "AI",
          "referralChart",
          "doughnut",
          referralMapping
        );

        renderPieChart(d, "AJ", "returnChart", "doughnut");

        renderFeedbackList(d, "AK", "AL", "feedbackListBox");
      }

      // ===================================================================
      // PH·∫¶N 4: C√ÅC H√ÄM V·∫º BI·ªÇU ƒê·ªí V√Ä HI·ªÇN TH·ªä
      // ===================================================================

      function getColumnByLetter(letter) {
        if (Object.keys(columnMapping).length === 0) {
          console.error("Column mapping ch∆∞a ƒë∆∞·ª£c t·∫£i!");
          return null;
        }
        const colName = columnMapping[letter];
        if (!colName) {
          console.warn(`Kh√¥ng t√¨m th·∫•y mapping cho ch·ªØ c√°i: ${letter}`);
          return null;
        }
        return colName;
      }

      function renderTopList(data, colName, elementId, top = 5) {
        if (!colName) return;
        const counts = {};
        data.forEach((row) => {
          const val = row[colName];
          if (val) counts[val] = (counts[val] || 0) + 1;
        });
        const sorted = Object.entries(counts)
          .sort(([, a], [, b]) => b - a)
          .slice(0, top);
        const max = sorted[0] ? sorted[0][1] : 1;

        const html = sorted
          .map(
            ([label, count], i) => `
                  <div class="mb-2">
                      <div class="flex justify-between mb-1">
                          <span class="font-medium text-sm text-gray-800">${label}</span>
                          <span class="text-sm text-gray-600">${count} ng∆∞·ªùi</span>
                      </div>
                      <div class="progress-bar">
                          <div class="progress-fill" style="width: ${
                            (count / max) * 100
                          }%; background: ${colors[i % colors.length]}"></div>
                      </div>
                  </div>
                `
          )
          .join("");
        document.getElementById(elementId).innerHTML = html;
      }

      function renderMeanList(data, colLetters, elementId) {
        const container = document.getElementById(elementId);
        if (!container) return;

        const meanData = colLetters
          .map((letter) => {
            const colName = getColumnByLetter(letter);
            if (!colName) return null;

            const labelMatch = colName.match(/\[(.*?)\]/);
            const label = labelMatch ? labelMatch[1] : colName;
            const mean = getMeanScore(data, colName);
            const stdDev = getStandardDeviation(data, colName, mean);
            return { label, mean, stdDev };
          })
          .filter((item) => item && item.mean > 0)
          .sort((a, b) => b.mean - a.mean);

        const maxMean = 5;

        const html = meanData
          .map(
            ({ label, mean, stdDev }, i) => `
                  <div class="mb-2">
                    <div class="flex justify-between mb-1">
                      <span class="font-medium text-sm text-gray-800">${label}</span>
                      <div class="flex items-baseline flex-shrink-0 ml-2">
                        <span class="text-sm text-gray-900 font-bold" title="ƒêi·ªÉm trung b√¨nh">${mean.toFixed(
                          2
                        )}</span>
                        <span class="text-xs text-gray-500 font-medium ml-1" title="ƒê·ªô l·ªách chu·∫©n">(s=${stdDev.toFixed(
                          2
                        )})</span>
                      </div>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: ${
                        (mean / maxMean) * 100
                      }%; background: ${colors[i % colors.length]}"></div>
                    </div>
                  </div>
                `
          )
          .join("");

        container.innerHTML = html;
      }

      function renderPieChart(data, colLetter, canvasId, type) {
        const colName = getColumnByLetter(colLetter);
        if (!colName) {
          console.error(`(Pie) Kh√¥ng t√¨m th·∫•y c·ªôt cho ch·ªØ c√°i: ${colLetter}`);
          return;
        }

        const counts = {};
        data.forEach((row) => {
          const val = row[colName];
          if (val) counts[val] = (counts[val] || 0) + 1;
        });

        createChart(
          canvasId,
          type,
          Object.keys(counts),
          Object.values(counts),
          true
        );
      }

      function renderBarChart(data, colLetter, canvasId, sort = false) {
        const colName = getColumnByLetter(colLetter);
        if (!colName) {
          console.error(`(Bar) Kh√¥ng t√¨m th·∫•y c·ªôt cho ch·ªØ c√°i: ${colLetter}`);
          return;
        }

        const counts = {};
        data.forEach((row) => {
          const val = row[colName];
          if (val) counts[val] = (counts[val] || 0) + 1;
        });

        let entries = Object.entries(counts);
        if (sort) entries = entries.sort(([, a], [, b]) => b - a);

        createChart(
          canvasId,
          "bar",
          entries.map((e) => e[0]),
          entries.map((e) => e[1]),
          false
        );
      }

      function renderOrderedChart(data, colLetter, canvasId, order) {
        const colName = getColumnByLetter(colLetter);
        if (!colName) {
          console.error(
            `(Ordered) Kh√¥ng t√¨m th·∫•y c·ªôt cho ch·ªØ c√°i: ${colLetter}`
          );
          return;
        }

        const counts = {};
        data.forEach((row) => {
          const val = row[colName];
          if (val) counts[val] = (counts[val] || 0) + 1;
        });

        const labels = order;
        const values = order.map((label) => counts[label] || 0);

        createChart(canvasId, "bar", labels, values, false);
      }

      function renderMultiChart(data, colLetter, canvasId) {
        const colName = getColumnByLetter(colLetter);
        if (!colName) {
          console.error(`(Multi) Kh√¥ng t√¨m th·∫•y c·ªôt cho ch·ªØ c√°i: ${colLetter}`);
          return;
        }

        const counts = {};
        data.forEach((row) => {
          const val = row[colName];
          if (val) {
            const answers = smartSplitAnswers(val);
            answers.forEach((item) => {
              if (item) counts[item] = (counts[item] || 0) + 1;
            });
          }
        });

        const sorted = Object.entries(counts).sort(([, a], [, b]) => b - a);
        createChart(
          canvasId,
          "bar",
          sorted.map((e) => e[0]),
          sorted.map((e) => e[1]),
          false,
          true
        );
      }

      // ƒê√£ x√≥a h√†m 'renderMultiColChart' b·ªã ch√∫ th√≠ch

      function renderFeedbackList(
        data,
        feelingColLetter,
        suggestionColLetter,
        elementId
      ) {
        const feelingCol = getColumnByLetter(feelingColLetter);
        const suggestionCol = getColumnByLetter(suggestionColLetter);
        const container = document.getElementById(elementId);

        if (!feelingCol || !suggestionCol || !container) {
          console.error(
            "Kh√¥ng t√¨m th·∫•y c·ªôt ho·∫∑c element cho danh s√°ch feedback."
          );
          return;
        }

        const feedbackItems = data
          .map((row, i) => {
            const feeling = row[feelingCol] || null;
            const suggestion = row[suggestionCol] || null;

            const hasMeaningfulSuggestion =
              suggestion &&
              suggestion.trim().length > 3 &&
              !suggestion.trim().toLowerCase().startsWith("kh√¥ng") &&
              !suggestion.trim().toLowerCase().startsWith("kh a") &&
              !suggestion.trim().toLowerCase().startsWith("ko");

            const hasMeaningfulFeeling =
              feeling &&
              feeling.trim().length > 3 &&
              !feeling.trim().toLowerCase().startsWith("kh√¥ng") &&
              !feeling.trim().toLowerCase().startsWith("ko");

            if (hasMeaningfulFeeling || hasMeaningfulSuggestion) {
              return `
                  <div class="p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border-l-4 border-purple-500 shadow-sm">
                      <div class="flex items-start gap-3 mb-3">
                          <span class="flex-shrink-0 w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold text-sm" title="C·∫£m nh·∫≠n">üòä</span>
                          <div class="text-gray-700 text-sm leading-relaxed w-full">
                              <strong class="text-gray-900">C·∫£m nh·∫≠n chuy·∫øn ƒëi:</strong>
                              <p class="mt-1">${
                                feeling || "<em>(Kh√¥ng c√≥)</em>"
                              }</p>
                          </div>
                      </div>
                      <div class="flex items-start gap-3">
                          <span class="flex-shrink-0 w-8 h-8 bg-purple-500 text-white rounded-full flex items-center justify-center font-bold text-sm" title="ƒê·ªÅ xu·∫•t">üí°</span>
                          <div class="text-gray-700 text-sm leading-relaxed w-full">
                              <strong class="text-gray-900">ƒê·ªÅ xu·∫•t:</strong>
                              <p class="mt-1">${
                                suggestion || "<em>(Kh√¥ng c√≥)</em>"
                              }</p>
                          </div>
                      </div>
                  </div>
                `;
            }
            return "";
          })
          .join("");

        container.innerHTML =
          feedbackItems.length > 0
            ? feedbackItems
            : '<p class="text-gray-500 text-center py-8">Ch∆∞a c√≥ c·∫£m nh·∫≠n ho·∫∑c ƒë·ªÅ xu·∫•t n√†o.</p>';
      }

      function renderMappedPieChart(data, colLetter, canvasId, type, mapping) {
        const colName = getColumnByLetter(colLetter);
        if (!colName) {
          console.error(
            `(MappedPie) Kh√¥ng t√¨m th·∫•y c·ªôt cho ch·ªØ c√°i: ${colLetter}`
          );
          return;
        }

        const counts = {};
        const orderedLabels = Object.values(mapping);
        orderedLabels.forEach((label) => {
          counts[label] = 0;
        });

        data.forEach((row) => {
          const val = String(row[colName]).trim();
          let label = mapping[val];
          if (!label) {
            const foundLabel = Object.values(mapping).find(
              (l) => l.toLowerCase() === val.toLowerCase()
            );
            if (foundLabel) label = foundLabel;
          }
          if (label) {
            counts[label] = (counts[label] || 0) + 1;
          }
        });

        const finalLabels = [];
        const finalValues = [];
        for (const label of orderedLabels) {
          if (counts[label] > 0) {
            finalLabels.push(label);
            finalValues.push(counts[label]);
          }
        }

        createChart(canvasId, type, finalLabels, finalValues, true);
      }

      function createChart(
        canvasId,
        type,
        labels,
        data,
        isPie = false,
        horizontal = false
      ) {
        const canvas = document.getElementById(canvasId);
        if (!canvas) {
          console.error(`Kh√¥ng t√¨m th·∫•y canvas: ${canvasId}`);
          return;
        }

        if (charts[canvasId]) charts[canvasId].destroy();

        const ctx = canvas.getContext("2d");

        const config = {
          type: horizontal ? "bar" : type,
          data: {
            labels: labels,
            datasets: [
              {
                label: "S·ªë l∆∞·ª£ng",
                data: data,
                backgroundColor: isPie
                  ? labels.map((_, i) => colors[i % colors.length])
                  : labels.map((_, i) => colors[i % colors.length] + "90"),
                borderColor: isPie
                  ? "#fff"
                  : labels.map((_, i) => colors[i % colors.length]),
                borderWidth: isPie ? 2 : 2,
                borderRadius: isPie ? 0 : 8,
                hoverOffset: isPie ? 15 : 0,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: isPie,
                position: "bottom",
                labels: {
                  padding: 12,
                  font: { size: 11, weight: "500" },
                  usePointStyle: true,
                  boxWidth: 12,
                  color: "#333",
                },
              },
              tooltip: {
                backgroundColor: "rgba(0, 0, 0, 0.85)",
                padding: 12,
                titleFont: { size: 13, weight: "bold" },
                bodyFont: { size: 12 },
                cornerRadius: 8,
                displayColors: true,
              },
            },
            scales: isPie
              ? {}
              : {
                  x: {
                    display: true,
                    grid: { display: false },
                    ticks: {
                      font: { size: 10 },
                      autoSkip: false,
                      maxRotation: horizontal ? 0 : 45,
                      minRotation: horizontal ? 0 : 45,
                      color: "#333",
                    },
                  },
                  y: {
                    display: true,
                    beginAtZero: true,
                    grid: { color: "rgba(0, 0, 0, 0.05)", drawBorder: false },
                    ticks: {
                      font: { size: 10 },
                      precision: 0,
                      color: "#333",
                    },
                  },
                },
          },
        };

        if (horizontal) {
          config.options.indexAxis = "y";
          config.options.scales.x.beginAtZero = true;
          config.options.scales.y.ticks.autoSkip = false;
        }

        charts[canvasId] = new Chart(ctx, config);
      }

      // ================================================
      // B·∫ÆT ƒê·∫¶U PH·∫¶N S·ª¨A L·ªñI (B·ªî SUNG H√ÄM)
      // ================================================

      // ===================================================================
      // PH·∫¶N 5: H√ÄM UI (ƒêI·ªÄU H∆Ø·ªöNG TAB) - B·ªä THI·∫æU TRONG CODE G·ªêC
      // ===================================================================

      function showSection(sectionId, clickedButton) {
        // 1. ·∫®n t·∫•t c·∫£ c√°c section content
        document.querySelectorAll(".section-content").forEach((section) => {
          section.classList.remove("active");
        });

        // 2. B·ªè active t·∫•t c·∫£ c√°c n√∫t
        document.querySelectorAll(".nav-btn").forEach((button) => {
          button.classList.remove("active");
        });

        // 3. Hi·ªÉn th·ªã section ƒë∆∞·ª£c ch·ªçn
        const activeSection = document.getElementById(sectionId + "-section");
        if (activeSection) {
          activeSection.classList.add("active");
        }

        // 4. K√≠ch ho·∫°t n√∫t ƒë∆∞·ª£c nh·∫•p
        if (clickedButton) {
          clickedButton.classList.add("active");
        }
      }

      // ================================================
      // K·∫æT TH√öC PH·∫¶N S·ª¨A L·ªñI (B·ªî SUNG H√ÄM)
      // ================================================

      function exportSummary() {
        const satMeanElement = document.getElementById("satisfactionRate");
        const satMeanText =
          satMeanElement.textContent || satMeanElement.innerText;
        const interestMeanList = document.getElementById("interestMeanList");
        let interestSummary = "N/A";

        if (interestMeanList && interestMeanList.children.length > 0) {
          const topItem = interestMeanList.children[0];
          const topLabel = topItem.querySelector(".font-medium").textContent;
          const topScoreText =
            topItem.querySelector(".flex-shrink-0").innerText;
          interestSummary = `${topLabel} (ƒêi·ªÉm: ${topScoreText.replace(
            "\n",
            " "
          )})`;
        }

        const summary = `
      B√ÅO C√ÅO T√ìM T·∫ÆT KH·∫¢O S√ÅT
      Ph√°t tri·ªÉn s·∫£n ph·∫©m du l·ªãch n√¥ng nghi·ªáp tr·∫£i nghi·ªám t·∫°i L√†ng hoa Sa ƒê√©c, t·ªânh ƒê·ªìng Th√°p

      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

      üìä T·ªîNG QUAN
      ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
      ‚Ä¢ T·ªïng s·ªë ph·∫£n h·ªìi: ${
        document.getElementById("totalResponses").textContent
      }
      ‚Ä¢ Nh√≥m tu·ªïi ph·ªï bi·∫øn: ${
        document.getElementById("popularAgeGroup").textContent
      }
      ‚Ä¢ ƒêi·ªÉm h√†i l√≤ng (T·ªïng th·ªÉ): ${satMeanText.replace("\n", " ")}
      ‚Ä¢ S·∫µn s√†ng quay l·∫°i: ${document.getElementById("returnRate").textContent}

      üìà NH·ªÆNG PH√ÅT HI·ªÜN CH√çNH
      ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
      ‚Ä¢ Quan t√¢m tr·∫£i nghi·ªám n√¥ng nghi·ªáp: ${
        document.getElementById("expInterestPercent").textContent
      }
      ‚Ä¢ S·∫µn s√†ng gi·ªõi thi·ªáu b·∫°n b√®: ${
        document.getElementById("referralPercent").textContent
      }
      ‚Ä¢ M·ª©c gi√° ch·∫•p nh·∫≠n (trung b√¨nh): ${
        document.getElementById("avgPrice").textContent
      }
      ‚Ä¢ Ho·∫°t ƒë·ªông ƒë∆∞·ª£c quan t√¢m nh·∫•t: ${interestSummary}

      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

      üéØ K·∫æT LU·∫¨N V√Ä KHUY·∫æN NGH·ªä

      D·ª±a tr√™n k·∫øt qu·∫£ kh·∫£o s√°t, c√≥ th·ªÉ th·∫•y:

      1. M·ª®C ƒê·ªò QUAN T√ÇM: Du kh√°ch c√≥ m·ª©c ƒë·ªô quan t√¢m cao ƒë·∫øn c√°c ho·∫°t ƒë·ªông
         tr·∫£i nghi·ªám n√¥ng nghi·ªáp t·∫°i L√†ng hoa Sa ƒê√©c.

      2. TI·ªÄM NƒÇNG PH√ÅT TRI·ªÇN: V·ªõi ƒëi·ªÉm h√†i l√≤ng t·ªïng th·ªÉ t·ªët v√† t·ª∑ l·ªá
         s·∫µn s√†ng quay l·∫°i cao, ƒë√¢y l√† c∆° h·ªôi l·ªõn ƒë·ªÉ ph√°t tri·ªÉn
         s·∫£n ph·∫©m du l·ªãch tr·∫£i nghi·ªám.

      3. M·ª®C GI√Å H·ª¢P L√ù: Du kh√°ch s·∫µn s√†ng chi tr·∫£ v·ªõi m·ª©c gi√° trung b√¨nh
         ph√π h·ª£p cho c√°c g√≥i tr·∫£i nghi·ªám 2-3 ti·∫øng.

      4. ƒê·ªÄ XU·∫§T PH√ÅT TRI·ªÇN (D·ª±a tr√™n ƒëi·ªÉm TB cao nh·∫•t):
         - Ph√°t tri·ªÉn c√°c ho·∫°t ƒë·ªông ƒë∆∞·ª£c quan t√¢m nh·∫•t: ${interestSummary}.
         - C·∫£i thi·ªán c√°c y·∫øu t·ªë c√≥ ƒëi·ªÉm h√†i l√≤ng th·∫•p (ki·ªÉm tra tab "M·ª©c ƒë·ªô h√†i l√≤ng").
         - TƒÉng c∆∞·ªùng ƒë√†o t·∫°o nh√¢n vi√™n v√† n√¥ng d√¢n ƒë·ªãa ph∆∞∆°ng.
         - Qu·∫£ng b√° r·ªông r√£i tr√™n c√°c k√™nh truy·ªÅn th√¥ng.

      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

      B√°o c√°o ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông t·ª´ Dashboard Ph√¢n T√≠ch Kh·∫£o S√°t
      Tr∆∞·ªùng ƒê·∫°i h·ªçc C√¥ng Nghi·ªáp TP.HCM - Khoa Th∆∞∆°ng m·∫°i - Du l·ªãch
      Ng√†y xu·∫•t: ${new Date().toLocaleDateString("vi-VN")}
          `;

        const blob = new Blob([summary], { type: "text/plain;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "Bao_Cao_Tom_Tat_Khao_Sat_Lang_Hoa_Sa_Dec.txt";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert("‚úÖ ƒê√£ xu·∫•t b√°o c√°o t√≥m t·∫Øt th√†nh c√¥ng!");
      }
    </script>
  </body>
</html>

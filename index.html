<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Kh·∫£o S√°t - L√†ng Hoa Sa ƒê√©c | IUH Tourism Research</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: "Inter", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        position: relative;
        overflow-x: hidden;
      }
      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(
            circle at 20% 50%,
            rgba(102, 126, 234, 0.4) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 80%,
            rgba(118, 75, 162, 0.4) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 40% 20%,
            rgba(240, 147, 251, 0.3) 0%,
            transparent 40%
          );
        animation: gradientShift 20s ease infinite;
        pointer-events: none;
        z-index: 0;
      }
      @keyframes gradientShift {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.8;
          transform: scale(1.1);
        }
      }
      .glassmorphism {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }
      .card-hover {
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }
      .card-hover::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        transition: left 0.5s;
      }
      .card-hover:hover::before {
        left: 100%;
      }
      .card-hover:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      }
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-fadeInUp {
        animation: fadeInUp 0.6s ease-out forwards;
      }
      .section-title {
        position: relative;
        display: inline-block;
      }
      .section-title::after {
        content: "";
        position: absolute;
        bottom: -8px;
        left: 0;
        width: 60px;
        height: 4px;
        background: linear-gradient(90deg, #667eea, #764ba2);
        border-radius: 2px;
        animation: expandWidth 0.6s ease-out;
      }
      @keyframes expandWidth {
        from {
          width: 0;
        }
        to {
          width: 60px;
        }
      }
      .nav-btn {
        padding: 12px 24px;
        margin: 0 8px;
        border-radius: 12px;
        font-weight: 600;
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        cursor: pointer;
        border: 2px solid transparent;
        position: relative;
        overflow: hidden;
      }
      .nav-btn::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }
      .nav-btn:hover::before {
        width: 300px;
        height: 300px;
      }
      .nav-btn.active {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        box-shadow: 0 8px 24px rgba(102, 126, 234, 0.5);
        transform: scale(1.05);
      }
      .nav-btn:not(.active) {
        background: rgba(255, 255, 255, 0.25);
        color: black;
        backdrop-filter: blur(10px);
      }
      .nav-btn:not(.active):hover {
        background: rgba(255, 255, 255, 0.4);
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      }
      .section-content {
        display: none;
        animation: fadeInContent 0.5s ease-out;
      }
      @keyframes fadeInContent {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .section-content.active {
        display: block;
      }
      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        position: relative;
        overflow: hidden;
      }
      .stat-card::after {
        content: "";
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          transparent 70%
        );
        animation: rotate 20s linear infinite;
      }
      @keyframes rotate {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      .stat-card p:first-child {
        color: rgba(255, 255, 255, 0.8);
      }
      .chart-wrapper {
        position: relative;
        height: 300px;
      }
      .chart-wrapper-large {
        position: relative;
        height: 600px; /* ƒê√£ fix chi·ªÅu cao */
      }
      .progress-bar {
        background: #e5e7eb;
        border-radius: 9999px;
        height: 8px;
        overflow: hidden;
      }
      .progress-fill {
        background: linear-gradient(90deg, #667eea, #764ba2);
        height: 100%;
        transition: width 0.5s;
      }
      .max-w-7xl {
        position: relative;
        z-index: 1;
      }
      .logo-section {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        margin-bottom: 20px;
      }
      .logo-container {
        width: 80px;
        height: 80px;
        background: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s;
      }
      .logo-container:hover {
        transform: scale(1.1) rotate(5deg);
      }
      .logo-container svg {
        width: 50px;
        height: 50px;
      }
      .project-badge {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 8px 20px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 600;
        display: inline-block;
        margin-top: 10px;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }
      .info-box {
        background: linear-gradient(135deg, #f093fb, #f5576c);
        color: white;
        padding: 20px;
        border-radius: 16px;
        margin-bottom: 20px;
        box-shadow: 0 8px 24px rgba(240, 147, 251, 0.3);
      }
      .info-box h3 {
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .info-box p {
        font-size: 14px;
        line-height: 1.6;
        opacity: 0.95;
      }
      .export-btn {
        background: linear-gradient(135deg, #43e97b, #38f9d7);
        color: black;
        padding: 12px 24px;
        border-radius: 12px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        transition: all 0.3s;
        border: none;
        box-shadow: 0 4px 12px rgba(67, 233, 123, 0.4);
      }
      .export-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(67, 233, 123, 0.6);
      }
      .metric-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        border-left: 4px solid #667eea;
      }
      .metric-label {
        font-size: 13px;
        color: #6b7280;
        font-weight: 500;
        margin-bottom: 8px;
      }
      .metric-value {
        font-size: 28px;
        font-weight: 700;
        color: #1f2937;
      }
      .highlight-box {
        background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
        padding: 16px;
        border-radius: 12px;
        margin: 10px 0;
        box-shadow: 0 4px 12px rgba(253, 203, 110, 0.3);
      }
      .highlight-box p {
        color: #2d3436;
        font-weight: 600;
        margin: 0;
      }
    </style>
  </head>
  <body class="min-h-screen p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
      <header
        class="glassmorphism rounded-2xl p-8 mb-8 shadow-2xl animate-fadeInUp"
      >
        <div class="text-center">
          <div class="logo-section">
            <div class="logo-container">
              <svg viewBox="0 0 100 100" fill="none">
                <rect
                  x="10"
                  y="10"
                  width="80"
                  height="80"
                  rx="10"
                  fill="#667eea"
                />
                <text
                  x="50"
                  y="65"
                  font-size="40"
                  font-weight="bold"
                  fill="white"
                  text-anchor="middle"
                >
                  IUH
                </text>
              </svg>
            </div>

            <div class="logo-container">
              <svg viewBox="0 0 100 100" fill="none">
                <circle cx="50" cy="50" r="40" fill="#f093fb" />
                <path d="M50 30 L40 50 L50 45 L60 50 Z" fill="white" />
                <circle cx="50" cy="55" r="8" fill="white" />
                <rect x="47" y="60" width="6" height="20" fill="#38f9d7" />
              </svg>
            </div>
          </div>

          <h1
            class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-3"
          >
            Dashboard Ph√¢n T√≠ch Kh·∫£o S√°t
          </h1>
          <p class="text-gray-800 font-semibold text-xl mb-2">
            Ph√°t tri·ªÉn s·∫£n ph·∫©m du l·ªãch n√¥ng nghi·ªáp tr·∫£i nghi·ªám
          </p>
          <p class="text-gray-700 font-medium text-lg mb-3">
            üå∏ L√†ng hoa Sa ƒê√©c, t·ªânh ƒê·ªìng Th√°p üå∏
          </p>

          <div class="project-badge">
            Kh√≥a lu·∫≠n t·ªët nghi·ªáp - Khoa Th∆∞∆°ng m·∫°i - Du l·ªãch
          </div>
          <p class="text-sm text-gray-600 mt-2">
            Tr∆∞·ªùng ƒê·∫°i h·ªçc C√¥ng Nghi·ªáp TP.HCM | Kh√≥a 18 - Qu·∫£n tr·ªã d·ªãch v·ª• du
            l·ªãch v√† l·ªØ h√†nh
          </p>

          <div class="mt-6">
            <button class="export-btn" onclick="exportSummary()">
              <svg
                width="20"
                height="20"
                fill="currentColor"
                viewBox="0 0 16 16"
              >
                <path
                  d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"
                />
                <path
                  d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"
                />
              </svg>
              Xu·∫•t B√°o C√°o T√≥m T·∫Øt
            </button>
          </div>
        </div>
      </header>

      <div class="info-box animate-fadeInUp" style="animation-delay: 0.1s">
        <h3>
          <svg width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
            <path
              d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"
            />
          </svg>
          V·ªÅ Kh·∫£o S√°t N√†y
        </h3>
        <p>
          Kh·∫£o s√°t n√†y nh·∫±m thu th·∫≠p √Ω ki·∫øn c·ªßa du kh√°ch v·ªÅ m·ª©c ƒë·ªô h√†i l√≤ng v√†
          nhu c·∫ßu ph√°t tri·ªÉn c√°c s·∫£n ph·∫©m du l·ªãch n√¥ng nghi·ªáp tr·∫£i nghi·ªám t·∫°i
          L√†ng hoa Sa ƒê√©c. Nh·ªØng √Ω ki·∫øn ƒë√≥ng g√≥p qu√Ω b√°u t·ª´ du kh√°ch l√† c∆° s·ªü
          quan tr·ªçng ƒë·ªÉ ƒë·ªÅ xu·∫•t c√°c gi·∫£i ph√°p ph√°t tri·ªÉn s·∫£n ph·∫©m du l·ªãch m·ªõi,
          h·∫•p d·∫´n v√† b·ªÅn v·ªØng h∆°n.
        </p>
      </div>

      <div
        class="glassmorphism rounded-2xl p-6 mb-8 shadow-xl animate-fadeInUp"
        style="animation-delay: 0.2s"
      >
        <div class="flex flex-wrap justify-center gap-3">
          <button
            class="nav-btn active"
            onclick="showSection('overview', this)"
          >
            üìä T·ªïng quan
          </button>
          <button class="nav-btn" onclick="showSection('demographics', this)">
            üë• Nh√¢n kh·∫©u h·ªçc
          </button>
          <button class="nav-btn" onclick="showSection('behavior', this)">
            üéØ H√†nh vi du l·ªãch
          </button>
          <button class="nav-btn" onclick="showSection('satisfaction', this)">
            ‚≠ê M·ª©c ƒë·ªô h√†i l√≤ng
          </button>
          <button class="nav-btn" onclick="showSection('experience', this)">
            üå± Tr·∫£i nghi·ªám n√¥ng nghi·ªáp
          </button>
          <button class="nav-btn" onclick="showSection('future', this)">
            üöÄ D·ª± ƒë·ªãnh t∆∞∆°ng lai
          </button>
          <button class="nav-btn" onclick="showSection('feedback', this)">
            üí¨ Ph·∫£n h·ªìi & ƒê·ªÅ xu·∫•t
          </button>
        </div>
      </div>

      <div id="overview-section" class="section-content active">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          <div class="stat-card rounded-2xl p-6 shadow-xl card-hover">
            <p class="text-white/80 text-sm font-medium mb-1">T·ªïng ph·∫£n h·ªìi</p>
            <p id="totalResponses" class="text-5xl font-bold">0</p>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl card-hover">
            <p class="text-gray-600 text-sm font-medium mb-1">
              Nh√≥m tu·ªïi ph·ªï bi·∫øn
            </p>
            <p id="popularAgeGroup" class="text-5xl font-bold text-gray-800">
              N/A
            </p>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl card-hover">
            <p class="text-gray-600 text-sm font-medium mb-1">T·ª∑ l·ªá h√†i l√≤ng</p>
            <p id="satisfactionRate" class="text-5xl font-bold text-green-600">
              0%
            </p>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl card-hover">
            <p class="text-gray-600 text-sm font-medium mb-1">
              S·∫µn s√†ng quay l·∫°i
            </p>
            <p id="returnRate" class="text-5xl font-bold text-blue-600">0%</p>
          </div>
        </div>

        <div class="glassmorphism rounded-2xl p-6 shadow-xl mb-6">
          <h3 class="section-title text-xl font-bold mb-6">
            üìà Nh·ªØng Ph√°t Hi·ªán Ch√≠nh
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="metric-card">
              <div class="metric-label">Quan t√¢m tr·∫£i nghi·ªám n√¥ng nghi·ªáp</div>
              <div class="metric-value" id="expInterestPercent">0%</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">S·∫µn s√†ng gi·ªõi thi·ªáu b·∫°n b√®</div>
              <div class="metric-value" id="referralPercent">0%</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">M·ª©c gi√° ch·∫•p nh·∫≠n (trung b√¨nh)</div>
              <div class="metric-value" id="avgPrice">N/A</div>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              Top 5 Ngh·ªÅ nghi·ªáp
            </h3>
            <div id="topOccupations" class="space-y-3"></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">Top 5 N∆°i ·ªü</h3>
            <div id="topLocations" class="space-y-3"></div>
          </div>
        </div>
      </div>

      <div id="demographics-section" class="section-content">
        <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
          <div class="glassmorphism rounded-2xl p-6 shadow-xl card-hover">
            <h3 class="section-title text-xl font-bold mb-6">Gi·ªõi t√≠nh</h3>
            <div class="chart-wrapper"><canvas id="genderChart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl card-hover">
            <h3 class="section-title text-xl font-bold mb-6">ƒê·ªô tu·ªïi</h3>
            <div class="chart-wrapper"><canvas id="ageChart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl card-hover">
            <h3 class="section-title text-xl font-bold mb-6">Ngh·ªÅ nghi·ªáp</h3>
            <div class="chart-wrapper">
              <canvas id="occupationChart"></canvas>
            </div>
          </div>
          <div
            class="glassmorphism rounded-2xl p-6 shadow-xl card-hover lg:col-span-2 xl:col-span-3"
          >
            <h3 class="section-title text-xl font-bold mb-6">N∆°i ·ªü hi·ªán t·∫°i</h3>
            <div class="chart-wrapper-large">
              <canvas id="locationChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div id="behavior-section" class="section-content">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              S·ªë l·∫ßn ƒë·∫øn Sa ƒê√©c
            </h3>
            <div class="chart-wrapper">
              <canvas id="visitFrequencyChart"></canvas>
            </div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">ƒêi c√πng ai?</h3>
            <div class="chart-wrapper">
              <canvas id="companionChart"></canvas>
            </div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              H√¨nh th·ª©c du l·ªãch
            </h3>
            <div class="chart-wrapper">
              <canvas id="travelTypeChart"></canvas>
            </div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              Th·ªùi gian l∆∞u tr√∫
            </h3>
            <div class="chart-wrapper">
              <canvas id="stayDurationChart"></canvas>
            </div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl lg:col-span-2">
            <h3 class="section-title text-xl font-bold mb-6">
              K√™nh bi·∫øt ƒë·∫øn L√†ng hoa
            </h3>
            <div class="chart-wrapper-large">
              <canvas id="sourceChart"></canvas>
            </div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl lg:col-span-2">
            <h3 class="section-title text-xl font-bold mb-6">
              M·ª•c ƒë√≠ch chuy·∫øn ƒëi
            </h3>
            <div class="chart-wrapper-large">
              <canvas id="purposeChart"></canvas>
            </div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl lg:col-span-2">
            <h3 class="section-title text-xl font-bold mb-6">
              Ho·∫°t ƒë·ªông ƒë√£ tham gia
            </h3>
            <div class="chart-wrapper-large">
              <canvas id="activitiesChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div id="satisfaction-section" class="section-content">
        <div class="highlight-box mb-6">
          <p>üìä ƒê√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ 11 y·∫øu t·ªë t·∫°i L√†ng hoa Sa ƒê√©c</p>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="text-lg font-bold mb-4">S·ª± phong ph√∫ lo·∫°i hoa</h3>
            <div class="chart-wrapper"><canvas id="sat1Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="text-lg font-bold mb-4">S·ª± hi·∫øu kh√°ch</h3>
            <div class="chart-wrapper"><canvas id="sat2Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="text-lg font-bold mb-4">C·∫£nh quan & v·ªá sinh</h3>
            <div class="chart-wrapper"><canvas id="sat3Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="text-lg font-bold mb-4">Th√°i ƒë·ªô nh√¢n vi√™n</h3>
            <div class="chart-wrapper"><canvas id="sat4Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="text-lg font-bold mb-4">C∆° s·ªü h·∫° t·∫ßng</h3>
            <div class="chart-wrapper"><canvas id="sat5Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="text-lg font-bold mb-4">N√©t ƒë·ªôc ƒë√°o</h3>
            <div class="chart-wrapper"><canvas id="sat6Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="text-lg font-bold mb-4">Ch·∫•t l∆∞·ª£ng d·ªãch v·ª•</h3>
            <div class="chart-wrapper"><canvas id="sat7Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="text-lg font-bold mb-4">Gi√° c·∫£ d·ªãch v·ª•</h3>
            <div class="chart-wrapper"><canvas id="sat8Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="text-lg font-bold mb-4">S·ª± an to√†n</h3>
            <div class="chart-wrapper"><canvas id="sat9Chart"></canvas></div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="text-lg font-bold mb-4">ƒêa d·∫°ng ho·∫°t ƒë·ªông</h3>
            <div class="chart-wrapper"><canvas id="sat10Chart"></canvas></div>
          </div>
          <div
            class="glassmorphism rounded-2xl p-6 shadow-xl lg:col-span-2 xl:col-span-3"
          >
            <h3 class="text-lg font-bold mb-4">T√≠nh k·∫øt n·ªëi tour</h3>
            <div class="chart-wrapper"><canvas id="sat11Chart"></canvas></div>
          </div>
        </div>
      </div>

      <div id="experience-section" class="section-content">
        <div class="highlight-box mb-6">
          <p>
            üå± Nhu c·∫ßu v√† k·ª≥ v·ªçng v·ªÅ ph√°t tri·ªÉn du l·ªãch n√¥ng nghi·ªáp tr·∫£i nghi·ªám
          </p>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              Quan t√¢m tr·∫£i nghi·ªám n√¥ng nghi·ªáp?
            </h3>
            <div class="chart-wrapper">
              <canvas id="expInterestChart"></canvas>
            </div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              M·ª©c chi tr·∫£ mong mu·ªën
            </h3>
            <div class="chart-wrapper">
              <canvas id="priceRangeChart"></canvas>
            </div>
          </div>
        </div>

        <div class="glassmorphism rounded-2xl p-6 shadow-xl mb-6">
          <h3 class="section-title text-xl font-bold mb-6">
            Ho·∫°t ƒë·ªông tr·∫£i nghi·ªám mu·ªën ph√°t tri·ªÉn
          </h3>
          <div class="chart-wrapper-large">
            <canvas id="expActivitiesChart"></canvas>
          </div>
        </div>

        <div class="grid grid-cols-1 gap-6">
          <div class="glassmorphism rounded-2xl p-6 shadow-xl mb-6">
            <h3 class="section-title text-xl font-bold mb-6">
              Y·∫øu t·ªë thu h√∫t tham gia
            </h3>
            <div class="chart-wrapper-large">
              <canvas id="attractionFactorsChart"></canvas>
            </div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              Y·∫øu t·ªë c·∫ßn c·∫£i thi·ªán
            </h3>
            <div class="chart-wrapper-large">
              <canvas id="improvementChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div id="future-section" class="section-content">
        <div class="highlight-box mb-6">
          <p>üöÄ D·ª± ƒë·ªãnh v√† cam k·∫øt c·ªßa du kh√°ch v·ªõi L√†ng hoa Sa ƒê√©c</p>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              Gi·ªõi thi·ªáu b·∫°n b√®?
            </h3>
            <div class="chart-wrapper">
              <canvas id="referralChart"></canvas>
            </div>
          </div>
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              D·ª± ƒë·ªãnh quay l·∫°i?
            </h3>
            <div class="chart-wrapper"><canvas id="returnChart"></canvas></div>
          </div>
        </div>
      </div>

      <div id="feedback-section" class="section-content">
        <div class="highlight-box mb-6">
          <p>üí¨ C·∫£m nh·∫≠n th·ª±c t·∫ø v√† ƒë·ªÅ xu·∫•t ph√°t tri·ªÉn t·ª´ du kh√°ch</p>
        </div>
        <div class="grid grid-cols-1 gap-6">
          <div class="glassmorphism rounded-2xl p-6 shadow-xl">
            <h3 class="section-title text-xl font-bold mb-6">
              Danh s√°ch C·∫£m nh·∫≠n & ƒê·ªÅ xu·∫•t
            </h3>
            <div
              id="feedbackListBox"
              class="space-y-4 max-h-[600px] overflow-y-auto pr-2"
            ></div>
          </div>
        </div>
      </div>

      <footer class="mt-8 glassmorphism rounded-2xl p-6 text-center shadow-xl">
        <p class="text-gray-700 font-semibold mb-2">
          ¬© 2025 Kh√≥a lu·∫≠n t·ªët nghi·ªáp - Khoa Th∆∞∆°ng m·∫°i - Du l·ªãch
        </p>
        <p class="text-gray-600 text-sm mb-2">
          Tr∆∞·ªùng ƒê·∫°i h·ªçc C√¥ng Nghi·ªáp Th√†nh ph·ªë H·ªì Ch√≠ Minh
        </p>
        <p class="text-gray-500 text-xs">
          Dashboard ph√°t tri·ªÉn b·ªüi nh√≥m sinh vi√™n Kh√≥a 18 - Qu·∫£n tr·ªã d·ªãch v·ª• du
          l·ªãch v√† l·ªØ h√†nh
        </p>
      </footer>
    </div>

    <script>
      const charts = {};
      const colors = [
        "#667eea",
        "#764ba2",
        "#f093fb",
        "#4facfe",
        "#43e97b",
        "#fa709a",
        "#fee140",
        "#30cfd0",
        "#a8edea",
        "#fed6e3",
      ];
      let globalData = [];
      let columnMapping = {};

      function showSection(section, element) {
        document
          .querySelectorAll(".section-content")
          .forEach((el) => el.classList.remove("active"));
        document
          .querySelectorAll(".nav-btn")
          .forEach((btn) => btn.classList.remove("active"));
        document.getElementById(`${section}-section`).classList.add("active");
        element.classList.add("active");
      }

      document.addEventListener("DOMContentLoaded", loadData);

      async function loadData() {
        try {
          console.log("ƒêang t·∫£i d·ªØ li·ªáu t·ª´ data.json...");
          const response = await fetch("data.json");

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const rawData = await response.json();
          console.log("D·ªØ li·ªáu th√¥:", rawData);

          if (Array.isArray(rawData)) {
            console.log("‚úì ƒê·ªãnh d·∫°ng: Array");
            console.log("S·ªë d√≤ng:", rawData.length);

            if (rawData.length < 2) {
              throw new Error(
                "File data.json kh√¥ng c√≥ d·ªØ li·ªáu (ch·ªâ c√≥ header)!"
              );
            }

            columnMapping = rawData[0];
            console.log("Column mapping:", columnMapping);

            globalData = rawData
              .slice(1)
              .map((row) => {
                const newRow = {};
                for (const key in row) {
                  if (columnMapping[key]) {
                    newRow[columnMapping[key]] = row[key];
                  }
                }
                return newRow;
              })
              .filter((row) =>
                Object.values(row).some(
                  (v) => v !== "" && v !== null && v !== undefined
                )
              );
          } else if (typeof rawData === "object" && rawData !== null) {
            console.log("‚ö†Ô∏è ƒê·ªãnh d·∫°ng: Object (ch·ªâ c√≥ mapping, kh√¥ng c√≥ data)");
            columnMapping = rawData;
            globalData = [];

            alert(
              "‚ö†Ô∏è C·∫¢NH B√ÅO: File data.json ch·ªâ ch·ª©a column mapping!\n\nHi·ªÉn th·ªã demo data ƒë·ªÉ b·∫°n xem giao di·ªán."
            );
            globalData = generateDemoData();
          } else {
            throw new Error("ƒê·ªãnh d·∫°ng data.json kh√¥ng h·ª£p l·ªá!");
          }

          console.log("D·ªØ li·ªáu ƒë√£ x·ª≠ l√Ω:", globalData);
          console.log("S·ªë b·∫£n ghi h·ª£p l·ªá:", globalData.length);

          if (globalData.length === 0) {
            alert("‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu!\n\nHi·ªÉn th·ªã demo data...");
            globalData = generateDemoData();
          }

          processAllData();
          console.log("‚úÖ T·∫£i d·ªØ li·ªáu th√†nh c√¥ng!");
        } catch (error) {
          console.error("‚ùå L·ªói chi ti·∫øt:", error);
          alert(
            `Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu!\n\nL·ªói: ${error.message}\n\nHi·ªÉn th·ªã demo data...`
          );

          columnMapping = {
            A: "D·∫•u th·ªùi gian",
            B: "1. Gi·ªõi t√≠nh:",
            C: "2. ƒê·ªô tu·ªïi:",
            D: "3. N∆°i ·ªü hi·ªán t·∫°i:",
            E: "4. Ngh·ªÅ nghi·ªáp c·ªßa Anh/Ch·ªã:",
            F: "5. Anh/Ch·ªã ƒë√£ ƒë·∫øn L√†ng hoa Sa ƒê√©c bao nhi√™u l·∫ßn?",
            G: "6. Anh/Ch·ªã bi·∫øt ƒë·∫øn L√†ng hoa Sa ƒê√©c th√¥ng qua k√™nh th√¥ng tin n√†o? (C√≥ th·ªÉ ch·ªçn nhi·ªÅu ƒë√°p √°n)",
            H: "7. Anh/Ch·ªã ƒëi du l·ªãch v·ªõi ai?",
            I: "8. M·ª•c ƒë√≠ch c·ªßa Anh/Ch·ªã khi ƒë·∫øn L√†ng hoa Sa ƒê√©c l√† g√¨? (C√≥ th·ªÉ ch·ªçn nhi·ªÅu ƒë√°p √°n)",
            J: "9. Anh/Ch·ªã ƒëi du l·ªãch theo h√¨nh th·ª©c n√†o? ",
            K: "10. Th·ªùi gian l∆∞u tr√∫ c·ªßa Anh/Ch·ªã t·∫°i Sa ƒê√©c l√† bao l√¢u? ",
            L: "11. Anh/Ch·ªã ƒë√£ tham gia nh·ªØng ho·∫°t ƒë·ªông n√†o t·∫°i Sa ƒê√©c? (C√≥ th·ªÉ ch·ªçn nhi·ªÅu ƒë√°p √°n)",
            M: "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [S·ª± phong ph√∫ c·ªßa c√°c lo·∫°i hoa]",
            N: "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [S·ª± hi·∫øu kh√°ch c·ªßa ng∆∞·ªùi d√¢n ƒë·ªãa ph∆∞∆°ng]",
            O: "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [C·∫£nh quan, v·ªá sinh m√¥i tr∆∞·ªùng]",
            P: "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [Th√°i ƒë·ªô ph·ª•c v·ª• c·ªßa nh√¢n vi√™n]",
            Q: "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [C∆° s·ªü h·∫° t·∫ßng]",
            R: "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [N√©t ri√™ng bi·ªát/ƒë·ªôc ƒë√°o c·ªßa ƒëi·ªÉm ƒë·∫øn]",
            S: "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [Ch·∫•t l∆∞·ª£ng d·ªãch v·ª•]",
            T: "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [Gi√° c·∫£ d·ªãch v·ª•]",
            U: "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [S·ª± an to√†n trong qu√° tr√¨nh tr·∫£i nghi·ªám]",
            V: "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [S·ª± ƒëa d·∫°ng c·ªßa c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám]",
            W: "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [T√≠nh k·∫øt n·ªëi gi·ªØa c√°c ƒëi·ªÉm tham quan trong khu v·ª±c Sa ƒê√©c (li√™n k·∫øt tour, tuy·∫øn, c∆° s·ªü l∆∞u tr√∫, ·∫©m th·ª±c)]",
            X: '13. Ngo√†i tham quan v√† ch·ª•p ·∫£nh, Anh/Ch·ªã c√≥ quan t√¢m ƒë·∫øn c√°c ho·∫°t ƒë·ªông mang t√≠nh "tr·∫£i nghi·ªám" n√¥ng nghi·ªáp kh√¥ng?',
            Y: "14. Anh/Ch·ªã quan t√¢m ƒë·∫øn vi·ªác ph√°t tri·ªÉn th√™m c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám n√¥ng nghi·ªáp n√†o sau ƒë√¢y t·∫°i L√†ng hoa Sa ƒê√©c?¬† [Tour tham quan v∆∞·ªùn hoa b·∫±ng xe ƒë·∫°p/xe ƒëi·ªán c√≥ h∆∞·ªõng d·∫´n vi√™n ƒë·ªãa ph∆∞∆°ng]",
            Z: '14. Anh/Ch·ªã quan t√¢m ƒë·∫øn vi·ªác ph√°t tri·ªÉn th√™m c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám n√¥ng nghi·ªáp n√†o sau ƒë√¢y t·∫°i L√†ng hoa Sa ƒê√©c?¬† [Tr·∫£i nghi·ªám "M·ªôt ng√†y l√†m n√¥ng d√¢n" (tr·ªçn g√≥i t·ª´ tr·ªìng, chƒÉm s√≥c, thu ho·∫°ch)]',
            AA: "14. Anh/Ch·ªã quan t√¢m ƒë·∫øn vi·ªác ph√°t tri·ªÉn th√™m c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám n√¥ng nghi·ªáp n√†o sau ƒë√¢y t·∫°i L√†ng hoa Sa ƒê√©c?¬† [Workshop c·∫Øm hoa/t·∫°o h√¨nh bonsai mini (do ngh·ªá nh√¢n h∆∞·ªõng d·∫´n)]",
            AB: "14. Anh/Ch·ªã quan t√¢m ƒë·∫øn vi·ªác ph√°t tri·ªÉn th√™m c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám n√¥ng nghi·ªáp n√†o sau ƒë√¢y t·∫°i L√†ng hoa Sa ƒê√©c?¬† [L·ªõp h·ªçc n·∫•u ƒÉn/l√†m b√°nh s·ª≠ d·ª•ng nguy√™n li·ªáu hoa (v√≠ d·ª•: b√°nh k·∫πp hoa h·ªìng, g·ªèi hoa...)]",
            AC: "14. Anh/Ch·ªã quan t√¢m ƒë·∫øn vi·ªác ph√°t tri·ªÉn th√™m c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám n√¥ng nghi·ªáp n√†o sau ƒë√¢y t·∫°i L√†ng hoa Sa ƒê√©c?¬† [L·ªõp h·ªçc/Workshop l√†m s·∫£n ph·∫©m th·ªß c√¥ng t·ª´ hoa (l√†m n·∫øn th∆°m, tr√† hoa, x√† ph√≤ng, tranh hoa)]",
            AD: "14. Anh/Ch·ªã quan t√¢m ƒë·∫øn vi·ªác ph√°t tri·ªÉn th√™m c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám n√¥ng nghi·ªáp n√†o sau ƒë√¢y t·∫°i L√†ng hoa Sa ƒê√©c?¬† [C√°c ho·∫°t ƒë·ªông g·∫Øn li·ªÅn vƒÉn h√≥a s√¥ng n∆∞·ªõc (t√°t m∆∞∆°ng, b·∫Øt c√° t·∫°i v∆∞·ªùn)]",
            AE: "14. Anh/Ch·ªã quan t√¢m ƒë·∫øn vi·ªác ph√°t tri·ªÉn th√™m c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám n√¥ng nghi·ªáp n√†o sau ƒë√¢y t·∫°i L√†ng hoa Sa ƒê√©c?¬† [L∆∞u tr√∫ t·∫°i nh√† d√¢n (Homestay) trong l√†ng hoa ƒë·ªÉ tr·∫£i nghi·ªám cu·ªôc s·ªëng c√πng n√¥ng d√¢n]",
            AF: "15. Anh/Ch·ªã s·∫µn s√†ng chi tr·∫£ bao nhi√™u/ng∆∞·ªùi cho m·ªôt g√≥i ho·∫°t ƒë·ªông tr·∫£i nghi·ªám (kho·∫£ng 2-3 ti·∫øng, bao g·ªìm h∆∞·ªõng d·∫´n v√† th√†nh ph·∫©m mang v·ªÅ)?",
            AG: "16. Theo Anh/Ch·ªã, nh·ªØng y·∫øu t·ªë n√†o l√† quan tr·ªçng nh·∫•t ƒë·ªÉ thu h√∫t kh√°ch tham gia du l·ªãch tr·∫£i nghi·ªám? (C√≥ th·ªÉ ch·ªçn nhi·ªÅu ph∆∞∆°ng √°n)",
            AH: "C√¢u 17: Theo Anh/Ch·ªã, nh·ªØng y·∫øu t·ªë c·∫ßn c·∫£i thi·ªán ƒë·ªÉ c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám n√¥ng nghi·ªáp h·∫•p d·∫´n h∆°n? (C√≥ th·ªÉ ch·ªçn nhi·ªÅu ph∆∞∆°ng √°n) ",
            AI: "C√¢u 18: Anh/Ch·ªã c√≥ s·∫µn l√≤ng gi·ªõi thi·ªáu b·∫°n b√®/ng∆∞·ªùi th√¢n ƒë·∫øn L√†ng hoa Sa ƒê√©c ƒë·ªÉ tham gia du l·ªãch n√¥ng nghi·ªáp tr·∫£i nghi·ªám kh√¥ng? ",
            AJ: 'C√¢u 19. Anh/Ch·ªã c√≥ d·ª± ƒë·ªãnh quay l·∫°i L√†ng hoa Sa ƒê√©c trong th·ªùi gian t·ªõi kh√¥ng?‚Äù"',
            AK: "20. Anh/Ch·ªã c·∫£m nh·∫≠n nh∆∞ th·∫ø n√†o v·ªÅ chuy·∫øn ƒëi L√†ng hoa Sa ƒê√©c l·∫ßn n√†y?",
            AL: "21. Anh/Ch·ªã c√≥ ƒë·ªÅ xu·∫•t g√¨ ƒë·ªÉ L√†ng hoa Sa ƒê√©c ph√°t tri·ªÉn c√°c s·∫£n ph·∫©m du l·ªãch tr·∫£i nghi·ªám h·∫•p d·∫´n h∆°n kh√¥ng?",
          };
          globalData = generateDemoData();
          processAllData();
        }
      }

      function generateDemoData() {
        const genders = ["Nam", "N·ªØ"];
        const ages = ["18-25", "26-35", "36-45", "46-55", "Tr√™n 55"];
        const locations = [
          "TP.HCM",
          "H√† N·ªôi",
          "ƒê·ªìng Th√°p",
          "C·∫ßn Th∆°",
          "An Giang",
          "Vƒ©nh Long",
        ];
        const occupations = [
          "Sinh vi√™n",
          "Nh√¢n vi√™n vƒÉn ph√≤ng",
          "Kinh doanh",
          "Gi√°o vi√™n",
          "T·ª± do",
          "H∆∞u tr√≠",
        ];
        const visits = ["L·∫ßn ƒë·∫ßu", "2-3 l·∫ßn", "4-5 l·∫ßn", "Tr√™n 5 l·∫ßn"];
        const companions = [
          "M·ªôt m√¨nh",
          "Gia ƒë√¨nh",
          "B·∫°n b√®",
          "ƒê·ªìng nghi·ªáp",
          "Tour du l·ªãch",
        ];
        const travelTypes = [
          "T·ª± t√∫c",
          "Tour tr·ªçn g√≥i",
          "Tour tr·ªçn g√≥i",
          "K·∫øt h·ª£p",
        ];
        const durations = [
          "N·ª≠a ng√†y",
          "1 ng√†y",
          "2 ng√†y 1 ƒë√™m",
          "3 ng√†y 2 ƒë√™m",
        ];
        const satisfactions = [
          "R·∫•t h√†i l√≤ng",
          "H√†i l√≤ng",
          "B√¨nh th∆∞·ªùng",
          "Kh√¥ng h√†i l√≤ng",
        ];
        const interests = [
          "R·∫•t quan t√¢m",
          "Quan t√¢m",
          "B√¨nh th∆∞·ªùng",
          "Kh√¥ng quan t√¢m",
        ];
        const prices = [
          "100.000 - 200.000 VNƒê",
          "200.000 - 300.000 VNƒê",
          "300.000 - 500.000 VNƒê",
          "Tr√™n 500.000 VNƒê",
        ];
        const yesNo = ["C√≥", "Kh√¥ng"];

        const demoData = [];
        for (let i = 0; i < 100; i++) {
          demoData.push({
            "D·∫•u th·ªùi gian": `2024-11-${String((i % 30) + 1).padStart(
              2,
              "0"
            )} ${String(Math.floor(Math.random() * 24)).padStart(
              2,
              "0"
            )}:${String(Math.floor(Math.random() * 60)).padStart(2, "0")}`,
            "1. Gi·ªõi t√≠nh:":
              genders[Math.floor(Math.random() * genders.length)],
            "2. ƒê·ªô tu·ªïi:": ages[Math.floor(Math.random() * ages.length)],
            "3. N∆°i ·ªü hi·ªán t·∫°i:":
              locations[Math.floor(Math.random() * locations.length)],
            "4. Ngh·ªÅ nghi·ªáp c·ªßa Anh/Ch·ªã:":
              occupations[Math.floor(Math.random() * occupations.length)],
            "5. Anh/Ch·ªã ƒë√£ ƒë·∫øn L√†ng hoa Sa ƒê√©c bao nhi√™u l·∫ßn?":
              visits[Math.floor(Math.random() * visits.length)],
            "6. Anh/Ch·ªã bi·∫øt ƒë·∫øn L√†ng hoa Sa ƒê√©c th√¥ng qua k√™nh th√¥ng tin n√†o? (C√≥ th·ªÉ ch·ªçn nhi·ªÅu ƒë√°p √°n)":
              "M·∫°ng x√£ h·ªôi, B·∫°n b√®/ng∆∞·ªùi th√¢n gi·ªõi thi·ªáu",
            "7. Anh/Ch·ªã ƒëi du l·ªãch v·ªõi ai?":
              companions[Math.floor(Math.random() * companions.length)],
            "8. M·ª•c ƒë√≠ch c·ªßa Anh/Ch·ªã khi ƒë·∫øn L√†ng hoa Sa ƒê√©c l√† g√¨? (C√≥ th·ªÉ ch·ªçn nhi·ªÅu ƒë√°p √°n)":
              "Du l·ªãch ngh·ªâ d∆∞·ª°ng, Ch·ª•p ·∫£nh",
            "9. Anh/Ch·ªã ƒëi du l·ªãch theo h√¨nh th·ª©c n√†o? ":
              travelTypes[Math.floor(Math.random() * travelTypes.length)],
            "10. Th·ªùi gian l∆∞u tr√∫ c·ªßa Anh/Ch·ªã t·∫°i Sa ƒê√©c l√† bao l√¢u? ":
              durations[Math.floor(Math.random() * durations.length)],
            "11. Anh/Ch·ªã ƒë√£ tham gia nh·ªØng ho·∫°t ƒë·ªông n√†o t·∫°i Sa ƒê√©c? (C√≥ th·ªÉ ch·ªçn nhi·ªÅu ƒë√°p √°n)":
              "Tham quan v∆∞·ªùn hoa, Ch·ª•p ·∫£nh, Mua hoa",
            "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [S·ª± phong ph√∫ c·ªßa c√°c lo·∫°i hoa]":
              satisfactions[Math.floor(Math.random() * satisfactions.length)],
            "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [S·ª± hi·∫øu kh√°ch c·ªßa ng∆∞·ªùi d√¢n ƒë·ªãa ph∆∞∆°ng]":
              satisfactions[Math.floor(Math.random() * satisfactions.length)],
            "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [C·∫£nh quan, v·ªá sinh m√¥i tr∆∞·ªùng]":
              satisfactions[Math.floor(Math.random() * satisfactions.length)],
            "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [Th√°i ƒë·ªô ph·ª•c v·ª• c·ªßa nh√¢n vi√™n]":
              satisfactions[Math.floor(Math.random() * satisfactions.length)],
            "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [C∆° s·ªü h·∫° t·∫ßng]":
              satisfactions[Math.floor(Math.random() * satisfactions.length)],
            "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [N√©t ri√™ng bi·ªát/ƒë·ªôc ƒë√°o c·ªßa ƒëi·ªÉm ƒë·∫øn]":
              satisfactions[Math.floor(Math.random() * satisfactions.length)],
            "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [Ch·∫•t l∆∞·ª£ng d·ªãch v·ª•]":
              satisfactions[Math.floor(Math.random() * satisfactions.length)],
            "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [Gi√° c·∫£ d·ªãch v·ª•]":
              satisfactions[Math.floor(Math.random() * satisfactions.length)],
            "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [S·ª± an to√†n trong qu√° tr√¨nh tr·∫£i nghi·ªám]":
              satisfactions[Math.floor(Math.random() * satisfactions.length)],
            "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [S·ª± ƒëa d·∫°ng c·ªßa c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám]":
              satisfactions[Math.floor(Math.random() * satisfactions.length)],
            "12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c√°c y·∫øu t·ªë sau: [T√≠nh k·∫øt n·ªëi gi·ªØa c√°c ƒëi·ªÉm tham quan trong khu v·ª±c Sa ƒê√©c (li√™n k·∫øt tour, tuy·∫øn, c∆° s·ªü l∆∞u tr√∫, ·∫©m th·ª±c)]":
              satisfactions[Math.floor(Math.random() * satisfactions.length)],
            '13. Ngo√†i tham quan v√† ch·ª•p ·∫£nh, Anh/Ch·ªã c√≥ quan t√¢m ƒë·∫øn c√°c ho·∫°t ƒë·ªông mang t√≠nh "tr·∫£i nghi·ªám" n√¥ng nghi·ªáp kh√¥ng?':
              interests[Math.floor(Math.random() * 2)],
            "14. Anh/Ch·ªã quan t√¢m ƒë·∫øn vi·ªác ph√°t tri·ªÉn th√™m c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám n√¥ng nghi·ªáp n√†o sau ƒë√¢y t·∫°i L√†ng hoa Sa ƒê√©c?¬† [Tour tham quan v∆∞·ªùn hoa b·∫±ng xe ƒë·∫°p/xe ƒëi·ªán c√≥ h∆∞·ªõng d·∫´n vi√™n ƒë·ªãa ph∆∞∆°ng]":
              interests[Math.floor(Math.random() * interests.length)],
            '14. Anh/Ch·ªã quan t√¢m ƒë·∫øn vi·ªác ph√°t tri·ªÉn th√™m c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám n√¥ng nghi·ªáp n√†o sau ƒë√¢y t·∫°i L√†ng hoa Sa ƒê√©c?¬† [Tr·∫£i nghi·ªám "M·ªôt ng√†y l√†m n√¥ng d√¢n" (tr·ªçn g√≥i t·ª´ tr·ªìng, chƒÉm s√≥c, thu ho·∫°ch)]':
              interests[Math.floor(Math.random() * interests.length)],
            "14. Anh/Ch·ªã quan t√¢m ƒë·∫øn vi·ªác ph√°t tri·ªÉn th√™m c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám n√¥ng nghi·ªáp n√†o sau ƒë√¢y t·∫°i L√†ng hoa Sa ƒê√©c?¬† [Workshop c·∫Øm hoa/t·∫°o h√¨nh bonsai mini (do ngh·ªá nh√¢n h∆∞·ªõng d·∫´n)]":
              interests[Math.floor(Math.random() * interests.length)],
            "14. Anh/Ch·ªã quan t√¢m ƒë·∫øn vi·ªác ph√°t tri·ªÉn th√™m c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám n√¥ng nghi·ªáp n√†o sau ƒë√¢y t·∫°i L√†ng hoa Sa ƒê√©c?¬† [L·ªõp h·ªçc n·∫•u ƒÉn/l√†m b√°nh s·ª≠ d·ª•ng nguy√™n li·ªáu hoa (v√≠ d·ª•: b√°nh k·∫πp hoa h·ªìng, g·ªèi hoa...)]":
              interests[Math.floor(Math.random() * interests.length)],
            "14. Anh/Ch·ªã quan t√¢m ƒë·∫øn vi·ªác ph√°t tri·ªÉn th√™m c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám n√¥ng nghi·ªáp n√†o sau ƒë√¢y t·∫°i L√†ng hoa Sa ƒê√©c?¬† [L·ªõp h·ªçc/Workshop l√†m s·∫£n ph·∫©m th·ªß c√¥ng t·ª´ hoa (l√†m n·∫øn th∆°m, tr√† hoa, x√† ph√≤ng, tranh hoa)]":
              interests[Math.floor(Math.random() * interests.length)],
            "14. Anh/Ch·ªã quan t√¢m ƒë·∫øn vi·ªác ph√°t tri·ªÉn th√™m c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám n√¥ng nghi·ªáp n√†o sau ƒë√¢y t·∫°i L√†ng hoa Sa ƒê√©c?¬† [C√°c ho·∫°t ƒë·ªông g·∫Øn li·ªÅn vƒÉn h√≥a s√¥ng n∆∞·ªõc (t√°t m∆∞∆°ng, b·∫Øt c√° t·∫°i v∆∞·ªùn)]":
              interests[Math.floor(Math.random() * interests.length)],
            "14. Anh/Ch·ªã quan t√¢m ƒë·∫øn vi·ªác ph√°t tri·ªÉn th√™m c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám n√¥ng nghi·ªáp n√†o sau ƒë√¢y t·∫°i L√†ng hoa Sa ƒê√©c?¬† [L∆∞u tr√∫ t·∫°i nh√† d√¢n (Homestay) trong l√†ng hoa ƒë·ªÉ tr·∫£i nghi·ªám cu·ªôc s·ªëng c√πng n√¥ng d√¢n]":
              interests[Math.floor(Math.random() * interests.length)],
            "15. Anh/Ch·ªã s·∫µn s√†ng chi tr·∫£ bao nhi√™u/ng∆∞·ªùi cho m·ªôt g√≥i ho·∫°t ƒë·ªông tr·∫£i nghi·ªám (kho·∫£ng 2-3 ti·∫øng, bao g·ªìm h∆∞·ªõng d·∫´n v√† th√†nh ph·∫©m mang v·ªÅ)?":
              prices[Math.floor(Math.random() * prices.length)],
            "16. Theo Anh/Ch·ªã, nh·ªØng y·∫øu t·ªë n√†o l√† quan tr·ªçng nh·∫•t ƒë·ªÉ thu h√∫t kh√°ch tham gia du l·ªãch tr·∫£i nghi·ªám? (C√≥ th·ªÉ ch·ªçn nhi·ªÅu ph∆∞∆°ng √°n)":
              "T√≠nh ƒë·ªôc ƒë√°o c·ªßa ho·∫°t ƒë·ªông, Gi√° c·∫£ h·ª£p l√Ω",
            "C√¢u 17: Theo Anh/Ch·ªã, nh·ªØng y·∫øu t·ªë c·∫ßn c·∫£i thi·ªán ƒë·ªÉ c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám n√¥ng nghi·ªáp h·∫•p d·∫´n h∆°n? (C√≥ th·ªÉ ch·ªçn nhi·ªÅu ph∆∞∆°ng √°n) ":
              "C·∫£i thi·ªán c∆° s·ªü v·∫≠t ch·∫•t, TƒÉng c∆∞·ªùng qu·∫£ng b√°",
            "C√¢u 18: Anh/Ch·ªã c√≥ s·∫µn l√≤ng gi·ªõi thi·ªáu b·∫°n b√®/ng∆∞·ªùi th√¢n ƒë·∫øn L√†ng hoa Sa ƒê√©c ƒë·ªÉ tham gia du l·ªãch n√¥ng nghi·ªáp tr·∫£i nghi·ªám kh√¥ng? ":
              yesNo[Math.floor(Math.random() * yesNo.length)],
            'C√¢u 19. Anh/Ch·ªã c√≥ d·ª± ƒë·ªãnh quay l·∫°i L√†ng hoa Sa ƒê√©c trong th·ªùi gian t·ªõi kh√¥ng?‚Äù"':
              yesNo[Math.floor(Math.random() * yesNo.length)],
            "20. Anh/Ch·ªã c·∫£m nh·∫≠n nh∆∞ th·∫ø n√†o v·ªÅ chuy·∫øn ƒëi L√†ng hoa Sa ƒê√©c l·∫ßn n√†y?":
              "R·∫•t th√≠ch! Hoa ƒë·∫πp, kh√¥ng kh√≠ trong l√†nh, ng∆∞·ªùi d√¢n th√¢n thi·ªán.",
            "21. Anh/Ch·ªã c√≥ ƒë·ªÅ xu·∫•t g√¨ ƒë·ªÉ L√†ng hoa Sa ƒê√©c ph√°t tri·ªÉn c√°c s·∫£n ph·∫©m du l·ªãch tr·∫£i nghi·ªám h·∫•p d·∫´n h∆°n kh√¥ng?":
              "N√™n c√≥ th√™m c√°c ho·∫°t ƒë·ªông t∆∞∆°ng t√°c, c·∫£i thi·ªán c∆° s·ªü v·∫≠t ch·∫•t v√† tƒÉng c∆∞·ªùng qu·∫£ng b√°.",
          });
        }
        console.log("‚úì ƒê√£ t·∫°o 100 m·∫´u demo data");
        return demoData;
      }

      // ============================================================
      // START FIX 1: H√ÄM T√ÅCH C√ÇU TR·∫¢ L·ªúI TH√îNG MINH (THEO LOGIC C·ª¶A B·∫†N)
      // ============================================================
      function smartSplitAnswers(text) {
        if (!text) return [];

        // 1. T√°ch b·∫±ng d·∫•u ph·∫©y nh∆∞ c≈©
        const parts = text.split(",");
        const results = [];
        let currentAnswer = "";

        for (let i = 0; i < parts.length; i++) {
          const part = parts[i].trim();
          if (!part) continue; // B·ªè qua n·∫øu c√≥,,

          if (currentAnswer === "") {
            // ƒê√¢y l√† ph·∫ßn t·ª≠ ƒë·∫ßu ti√™n, lu√¥n l√† b·∫Øt ƒë·∫ßu c·ªßa m·ªôt c√¢u tr·∫£ l·ªùi
            currentAnswer = part;
          } else {
            // 2. Ki·ªÉm tra k√Ω t·ª± ƒë·∫ßu ti√™n
            const firstChar = part.charAt(0);
            const isUpperCase =
              firstChar === firstChar.toUpperCase() &&
              firstChar !== firstChar.toLowerCase();

            // 3. N·∫øu l√† CH·ªÆ HOA v√† ƒë·ªô d√†i > 3
            if (isUpperCase && part.length > 3) {
              // 4. ƒê√¢y l√† c√¢u tr·∫£ l·ªùi m·ªõi
              results.push(currentAnswer); // ƒê·∫©y c√¢u tr·∫£ l·ªùi c≈© v√†o
              currentAnswer = part; // B·∫Øt ƒë·∫ßu c√¢u m·ªõi
            } else {
              // 5. N·∫øu l√† ch·ªØ th∆∞·ªùng -> l√† ph·∫ßn ti·∫øp theo
              currentAnswer += ", " + part; // N·ªëi v√†o c√¢u hi·ªán t·∫°i
            }
          }
        }

        // ƒê·ª´ng qu√™n ƒë·∫©y c√¢u tr·∫£ l·ªùi cu·ªëi c√πng v√†o
        if (currentAnswer) {
          results.push(currentAnswer);
        }

        return results.filter((item) => item && item.length > 0);
      }
      // ============================================================
      // END FIX 1
      // ============================================================

      function processAllData() {
        const d = globalData;
        document.getElementById("totalResponses").textContent = d.length;

        if (d.length === 0) {
          console.warn("Kh√¥ng c√≥ d·ªØ li·ªáu kh·∫£o s√°t ƒë·ªÉ x·ª≠ l√Ω.");
          document.getElementById("popularAgeGroup").textContent = "N/A";
          return;
        }

        const ageCounts = {};
        d.forEach((row) => {
          const ageGroup = row["2. ƒê·ªô tu·ªïi:"];
          if (ageGroup) ageCounts[ageGroup] = (ageCounts[ageGroup] || 0) + 1;
        });

        let popularAgeGroup = "N/A",
          maxCount = 0;
        for (const ageGroup in ageCounts) {
          if (ageCounts[ageGroup] > maxCount) {
            maxCount = ageCounts[ageGroup];
            popularAgeGroup = ageGroup;
          }
        }
        document.getElementById("popularAgeGroup").textContent =
          popularAgeGroup;

        const satKeys = Object.keys(d[0]).filter((k) =>
          k.includes("12. Anh/Ch·ªã vui l√≤ng ƒë√°nh gi√°")
        );
        let satisfiedTotal = 0,
          satCount = 0;
        d.forEach((row) => {
          satKeys.forEach((key) => {
            const val = row[key];
            if (val) {
              satCount++;
              if (val === "R·∫•t h√†i l√≤ng" || val === "H√†i l√≤ng")
                satisfiedTotal++;
            }
          });
        });
        const satRate =
          satCount > 0 ? ((satisfiedTotal / satCount) * 100).toFixed(1) : "0";
        document.getElementById("satisfactionRate").textContent = satRate + "%";

        // ==================================================
        // START FIX 2: S·ª≠a logic th·∫ª th·ªëng k√™ (C·ªôt AJ, X, AI, AF)
        // ==================================================

        // Return rate (C·ªôt AJ)
        // Key n√†y l·∫•y t·ª´ file data.json B·∫†N M·ªöI G·ª¨I (k·∫øt th√∫c b·∫±ng ?")
        const returnKey =
          "C√¢u 19. Anh/Ch·ªã c√≥ d·ª± ƒë·ªãnh quay l·∫°i L√†ng hoa Sa ƒê√©c trong th·ªùi gian t·ªõi kh√¥ng?‚Äù";

        let actualReturnKey = returnKey;
        if (!globalData[0].hasOwnProperty(returnKey)) {
          // Th·ª≠ key c≈© (demo)
          const oldKey =
            'C√¢u 19. Anh/Ch·ªã c√≥ d·ª± ƒë·ªãnh quay l·∫°i L√†ng hoa Sa ƒê√©c trong th·ªùi gian t·ªõi kh√¥ng?‚Äù"';
          if (globalData[0].hasOwnProperty(oldKey)) {
            actualReturnKey = oldKey;
            console.log("ƒê√£ t·ª± ƒë·ªông s·ª≠a key 'Quay l·∫°i' (AJ) v·ªÅ key demo.");
          } else {
            console.error("Kh√¥ng t√¨m th·∫•y key cho c·ªôt AJ (Quay l·∫°i)!");
          }
        }

        const returnYes = d.filter((row) => {
          const val = row[actualReturnKey];
          if (!val) return false;
          const valLower = String(val).toLowerCase();
          return valLower.includes("c√≥") || valLower.includes("ch·∫Øc ch·∫Øn");
        }).length;
        const returnRate = ((returnYes / d.length) * 100).toFixed(1);
        document.getElementById("returnRate").textContent = returnRate + "%";

        // Experience interest (C·ªôt X)
        const expKey =
          '13. Ngo√†i tham quan v√† ch·ª•p ·∫£nh, Anh/Ch·ªã c√≥ quan t√¢m ƒë·∫øn c√°c ho·∫°t ƒë·ªông mang t√≠nh "tr·∫£i nghi·ªám" n√¥ng nghi·ªáp kh√¥ng?';
        const expYes = d.filter((row) => {
          const val = row[expKey];
          if (!val) return false;
          const valLower = String(val).toLowerCase();
          return (
            valLower.includes("quan t√¢m") ||
            valLower.includes("r·∫•t") ||
            valLower === "4" ||
            valLower === "5"
          );
        }).length;
        const expRate = ((expYes / d.length) * 100).toFixed(1);
        document.getElementById("expInterestPercent").textContent =
          expRate + "%";

        // Referral rate (C·ªôt AI)
        const refKey =
          "C√¢u 18: Anh/Ch·ªã c√≥ s·∫µn l√≤ng gi·ªõi thi·ªáu b·∫°n b√®/ng∆∞·ªùi th√¢n ƒë·∫øn L√†ng hoa Sa ƒê√©c ƒë·ªÉ tham gia du l·ªãch n√¥ng nghi·ªáp tr·∫£i nghi·ªám kh√¥ng? ";
        const refYes = d.filter((row) => {
          const val = row[refKey];
          if (!val) return false;
          const valLower = String(val).toLowerCase();
          return (
            valLower.includes("c√≥") || valLower === "4" || valLower === "5"
          );
        }).length;
        const refRate = ((refYes / d.length) * 100).toFixed(1);
        document.getElementById("referralPercent").textContent = refRate + "%";

        // Average price (C·ªôt AF)
        const priceKey =
          "15. Anh/Ch·ªã s·∫µn s√†ng chi tr·∫£ bao nhi√™u/ng∆∞·ªùi cho m·ªôt g√≥i ho·∫°t ƒë·ªông tr·∫£i nghi·ªám (kho·∫£ng 2-3 ti·∫øng, bao g·ªìm h∆∞·ªõng d·∫´n v√† th√†nh ph·∫©m mang v·ªÅ)?";
        const priceRanges = {
          "100.000 - 200.000 VNƒê": 150000,
          "200.000 - 300.000 VNƒê": 250000,
          "Tr√™n 300.000 VNƒê": 350000,
          "D∆∞·ªõi 100.000 VNƒê": 80000,
        };
        let totalPrice = 0,
          priceCount = 0;
        d.forEach((row) => {
          const val = row[priceKey];
          if (val && priceRanges[val]) {
            totalPrice += priceRanges[val];
            priceCount++;
          }
        });
        const avgPrice =
          priceCount > 0 ? Math.round(totalPrice / priceCount) : 0;
        document.getElementById("avgPrice").textContent =
          avgPrice > 0 ? (avgPrice / 1000).toFixed(0) + "K VNƒê" : "N/A";
        // ==================================================
        // END FIX 2
        // ==================================================

        renderTopList(d, "4. Ngh·ªÅ nghi·ªáp c·ªßa Anh/Ch·ªã:", "topOccupations");
        renderTopList(d, "3. N∆°i ·ªü hi·ªán t·∫°i:", "topLocations");

        renderPieChart(d, "B", "genderChart", "doughnut");
        renderBarChart(d, "C", "ageChart");
        renderBarChart(d, "E", "occupationChart", true);
        renderBarChart(d, "D", "locationChart", true);

        renderPieChart(d, "F", "visitFrequencyChart", "pie");
        renderPieChart(d, "H", "companionChart", "doughnut");
        renderPieChart(d, "J", "travelTypeChart", "polarArea");
        renderBarChart(d, "K", "stayDurationChart");
        renderMultiChart(d, "G", "sourceChart");
        renderMultiChart(d, "I", "purposeChart");
        renderMultiChart(d, "L", "activitiesChart");

        const satOrder = [
          "R·∫•t h√†i l√≤ng",
          "H√†i l√≤ng",
          "B√¨nh th∆∞·ªùng",
          "Kh√¥ng h√†i l√≤ng",
          "R·∫•t kh√¥ng h√†i l√≤ng",
        ];
        renderOrderedChart(d, "M", "sat1Chart", satOrder);
        renderOrderedChart(d, "N", "sat2Chart", satOrder);
        renderOrderedChart(d, "O", "sat3Chart", satOrder);
        renderOrderedChart(d, "P", "sat4Chart", satOrder);
        renderOrderedChart(d, "Q", "sat5Chart", satOrder);
        renderOrderedChart(d, "R", "sat6Chart", satOrder);
        renderOrderedChart(d, "S", "sat7Chart", satOrder);
        renderOrderedChart(d, "T", "sat8Chart", satOrder);
        renderOrderedChart(d, "U", "sat9Chart", satOrder);
        renderOrderedChart(d, "V", "sat10Chart", satOrder);
        renderOrderedChart(d, "W", "sat11Chart", satOrder);

        const interestMapping = {
          5: "R·∫•t quan t√¢m",
          4: "Quan t√¢m",
          3: "B√¨nh th∆∞·ªùng",
          2: "Kh√¥ng quan t√¢m",
          1: "Ho√†n to√†n kh√¥ng quan t√¢m",
        };
        renderMappedPieChart(
          d,
          "X",
          "expInterestChart",
          "doughnut",
          interestMapping
        );
        renderBarChart(d, "AF", "priceRangeChart");

        const expCols = ["Y", "Z", "AA", "AB", "AC", "AD", "AE"];
        renderMultiColChart(d, expCols, "expActivitiesChart");

        renderMultiChart(d, "AG", "attractionFactorsChart");
        renderMultiChart(d, "AH", "improvementChart");

        const referralMapping = {
          5: "R·∫•t s·∫µn l√≤ng",
          4: "S·∫µn l√≤ng",
          3: "B√¨nh th∆∞·ªùng",
          2: "Kh√¥ng s·∫µn l√≤ng",
          1: "Ch·∫Øc ch·∫Øn kh√¥ng",
        };
        renderMappedPieChart(
          d,
          "AI",
          "referralChart",
          "doughnut",
          referralMapping
        );

        renderPieChart(d, "AJ", "returnChart", "doughnut");

        renderFeedbackList(d, "AK", "AL", "feedbackListBox");
      }

      function getColumnByLetter(letter) {
        if (Object.keys(columnMapping).length === 0) {
          console.error("Column mapping ch∆∞a ƒë∆∞·ª£c t·∫£i!");
          return null;
        }
        const colName = columnMapping[letter];
        if (!colName) {
          console.warn(`Kh√¥ng t√¨m th·∫•y mapping cho ch·ªØ c√°i: ${letter}`);
          return null;
        }
        return colName;
      }

      function renderTopList(data, colName, elementId, top = 5) {
        if (!colName) return;
        const counts = {};
        data.forEach((row) => {
          const val = row[colName];
          if (val) counts[val] = (counts[val] || 0) + 1;
        });
        const sorted = Object.entries(counts)
          .sort(([, a], [, b]) => b - a)
          .slice(0, top);
        const max = sorted[0] ? sorted[0][1] : 1;

        const html = sorted
          .map(
            ([label, count], i) => `
                <div class="mb-2">
                    <div class="flex justify-between mb-1">
                        <span class="font-medium text-sm text-gray-800">${label}</span>
                        <span class="text-sm text-gray-600">${count} ng∆∞·ªùi</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${
                          (count / max) * 100
                        }%; background: ${colors[i % colors.length]}"></div>
                    </div>
                </div>
            `
          )
          .join("");
        document.getElementById(elementId).innerHTML = html;
      }

      function renderPieChart(data, colLetter, canvasId, type) {
        const colName = getColumnByLetter(colLetter);
        if (!colName) {
          console.error(`(Pie) Kh√¥ng t√¨m th·∫•y c·ªôt cho ch·ªØ c√°i: ${colLetter}`);
          return;
        }

        const counts = {};
        data.forEach((row) => {
          const val = row[colName];
          if (val) counts[val] = (counts[val] || 0) + 1;
        });

        createChart(
          canvasId,
          type,
          Object.keys(counts),
          Object.values(counts),
          true
        );
      }

      function renderBarChart(data, colLetter, canvasId, sort = false) {
        const colName = getColumnByLetter(colLetter);
        if (!colName) {
          console.error(`(Bar) Kh√¥ng t√¨m th·∫•y c·ªôt cho ch·ªØ c√°i: ${colLetter}`);
          return;
        }

        const counts = {};
        data.forEach((row) => {
          const val = row[colName];
          if (val) counts[val] = (counts[val] || 0) + 1;
        });

        let entries = Object.entries(counts);
        if (sort) entries = entries.sort(([, a], [, b]) => b - a);

        createChart(
          canvasId,
          "bar",
          entries.map((e) => e[0]),
          entries.map((e) => e[1]),
          false
        );
      }

      function renderOrderedChart(data, colLetter, canvasId, order) {
        const colName = getColumnByLetter(colLetter);
        if (!colName) {
          console.error(
            `(Ordered) Kh√¥ng t√¨m th·∫•y c·ªôt cho ch·ªØ c√°i: ${colLetter}`
          );
          return;
        }

        const counts = {};
        data.forEach((row) => {
          const val = row[colName];
          if (val) counts[val] = (counts[val] || 0) + 1;
        });

        const labels = order;
        const values = order.map((label) => counts[label] || 0);

        createChart(canvasId, "bar", labels, values, false);
      }

      // ============================================================
      // H√ÄM RENDER MULTI CHART - ƒê√É C·∫¨P NH·∫¨T S·ª¨ D·ª§NG SMART SPLIT
      // ============================================================
      function renderMultiChart(data, colLetter, canvasId) {
        const colName = getColumnByLetter(colLetter);
        if (!colName) {
          console.error(`(Multi) Kh√¥ng t√¨m th·∫•y c·ªôt cho ch·ªØ c√°i: ${colLetter}`);
          return;
        }

        const counts = {};
        data.forEach((row) => {
          const val = row[colName];
          if (val) {
            // S·ª¨ D·ª§NG H√ÄM T√ÅCH TH√îNG MINH
            const answers = smartSplitAnswers(val);
            answers.forEach((item) => {
              if (item) counts[item] = (counts[item] || 0) + 1;
            });
          }
        });

        const sorted = Object.entries(counts).sort(([, a], [, b]) => b - a);
        createChart(
          canvasId,
          "bar",
          sorted.map((e) => e[0]),
          sorted.map((e) => e[1]),
          false,
          true
        );
      }

      function renderMultiColChart(data, colLetters, canvasId) {
        const counts = {};

        colLetters.forEach((letter) => {
          const colName = getColumnByLetter(letter);
          if (!colName) {
            console.error(
              `(MultiCol) Kh√¥ng t√¨m th·∫•y c·ªôt cho ch·ªØ c√°i: ${letter}`
            );
            return;
          }

          data.forEach((row) => {
            const val = row[colName];
            const valLower = String(val).toLowerCase();
            if (
              val &&
              (valLower.includes("quan t√¢m") || valLower.includes("c√≥"))
            ) {
              const activityMatch = colName.match(/\[(.*?)\]/);
              if (activityMatch) {
                const activity = activityMatch[1];
                counts[activity] = (counts[activity] || 0) + 1;
              }
            }
          });
        });

        const sorted = Object.entries(counts).sort(([, a], [, b]) => b - a);
        createChart(
          canvasId,
          "bar",
          sorted.map((e) => e[0]),
          sorted.map((e) => e[1]),
          false,
          true
        );
      }

      function renderFeedbackList(
        data,
        feelingColLetter,
        suggestionColLetter,
        elementId
      ) {
        const feelingCol = getColumnByLetter(feelingColLetter);
        const suggestionCol = getColumnByLetter(suggestionColLetter);
        const container = document.getElementById(elementId);

        if (!feelingCol || !suggestionCol || !container) {
          console.error(
            "Kh√¥ng t√¨m th·∫•y c·ªôt ho·∫∑c element cho danh s√°ch feedback."
          );
          return;
        }

        const feedbackItems = data
          .map((row, i) => {
            const feeling = row[feelingCol] || null;
            const suggestion = row[suggestionCol] || null;

            // L·ªçc ra c√°c c√¢u tr·∫£ l·ªùi "kh√¥ng", "ko"...
            const hasMeaningfulSuggestion =
              suggestion &&
              suggestion.trim().length > 3 &&
              !suggestion.trim().toLowerCase().startsWith("kh√¥ng") &&
              !suggestion.trim().toLowerCase().startsWith("kh a") &&
              !suggestion.trim().toLowerCase().startsWith("ko");

            const hasMeaningfulFeeling =
              feeling &&
              feeling.trim().length > 3 &&
              !feeling.trim().toLowerCase().startsWith("kh√¥ng") &&
              !feeling.trim().toLowerCase().startsWith("ko");

            if (hasMeaningfulFeeling || hasMeaningfulSuggestion) {
              return `
                        <div class="p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border-l-4 border-purple-500 shadow-sm">
                            <div class="flex items-start gap-3 mb-3">
                                <span class="flex-shrink-0 w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold text-sm" title="C·∫£m nh·∫≠n">üòä</span>
                                <div class="text-gray-700 text-sm leading-relaxed w-full">
                                    <strong class="text-gray-900">C·∫£m nh·∫≠n chuy·∫øn ƒëi:</strong>
                                    <p class="mt-1">${
                                      feeling || "<em>(Kh√¥ng c√≥)</em>"
                                    }</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3">
                                <span class="flex-shrink-0 w-8 h-8 bg-purple-500 text-white rounded-full flex items-center justify-center font-bold text-sm" title="ƒê·ªÅ xu·∫•t">üí°</span>
                                <div class="text-gray-700 text-sm leading-relaxed w-full">
                                    <strong class="text-gray-900">ƒê·ªÅ xu·∫•t:</strong>
                                    <p class="mt-1">${
                                      suggestion || "<em>(Kh√¥ng c√≥)</em>"
                                    }</p>
                                </div>
                            </div>
                        </div>
                    `;
            }
            return "";
          })
          .join("");

        container.innerHTML =
          feedbackItems.length > 0
            ? feedbackItems
            : '<p class="text-gray-500 text-center py-8">Ch∆∞a c√≥ c·∫£m nh·∫≠n ho·∫∑c ƒë·ªÅ xu·∫•t n√†o.</p>';
      }

      function renderMappedPieChart(data, colLetter, canvasId, type, mapping) {
        const colName = getColumnByLetter(colLetter);
        if (!colName) {
          console.error(
            `(MappedPie) Kh√¥ng t√¨m th·∫•y c·ªôt cho ch·ªØ c√°i: ${colLetter}`
          );
          return;
        }

        const counts = {};
        const orderedLabels = Object.values(mapping);
        orderedLabels.forEach((label) => {
          counts[label] = 0;
        });

        data.forEach((row) => {
          const val = String(row[colName]).trim();
          // Th·ª≠ t√¨m key d·∫°ng s·ªë (1, 2, 3...)
          let label = mapping[val];

          // N·∫øu kh√¥ng th·∫•y, th·ª≠ t√¨m key d·∫°ng ch·ªØ (R·∫•t quan t√¢m, ...)
          if (!label) {
            const foundLabel = Object.values(mapping).find(
              (l) => l.toLowerCase() === val.toLowerCase()
            );
            if (foundLabel) label = foundLabel;
          }

          if (label) {
            counts[label] = (counts[label] || 0) + 1;
          }
        });

        const finalLabels = [];
        const finalValues = [];
        for (const label of orderedLabels) {
          if (counts[label] > 0) {
            finalLabels.push(label);
            finalValues.push(counts[label]);
          }
        }

        createChart(canvasId, type, finalLabels, finalValues, true);
      }

      function createChart(
        canvasId,
        type,
        labels,
        data,
        isPie = false,
        horizontal = false
      ) {
        const canvas = document.getElementById(canvasId);
        if (!canvas) {
          console.error(`Kh√¥ng t√¨m th·∫•y canvas: ${canvasId}`);
          return;
        }

        if (charts[canvasId]) charts[canvasId].destroy();

        const ctx = canvas.getContext("2d");

        const config = {
          type: horizontal ? "bar" : type,
          data: {
            labels: labels,
            datasets: [
              {
                label: "S·ªë l∆∞·ª£ng",
                data: data,
                backgroundColor: isPie
                  ? labels.map((_, i) => colors[i % colors.length])
                  : labels.map((_, i) => colors[i % colors.length] + "90"),
                borderColor: isPie
                  ? "#fff"
                  : labels.map((_, i) => colors[i % colors.length]),
                borderWidth: isPie ? 2 : 2,
                borderRadius: isPie ? 0 : 8,
                hoverOffset: isPie ? 15 : 0,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: isPie,
                position: "bottom",
                labels: {
                  padding: 12,
                  font: { size: 11, weight: "500" },
                  usePointStyle: true,
                  boxWidth: 12,
                  color: "#333",
                },
              },
              tooltip: {
                backgroundColor: "rgba(0, 0, 0, 0.85)",
                padding: 12,
                titleFont: { size: 13, weight: "bold" },
                bodyFont: { size: 12 },
                cornerRadius: 8,
                displayColors: true,
              },
            },
            scales: isPie
              ? {}
              : {
                  x: {
                    display: true,
                    grid: { display: false },
                    ticks: {
                      font: { size: 10 },
                      autoSkip: false,
                      maxRotation: horizontal ? 0 : 45,
                      minRotation: horizontal ? 0 : 45,
                      color: "#333",
                    },
                  },
                  y: {
                    display: true,
                    beginAtZero: true,
                    grid: { color: "rgba(0, 0, 0, 0.05)", drawBorder: false },
                    ticks: {
                      font: { size: 10 },
                      precision: 0,
                      color: "#333",
                    },
                  },
                },
          },
        };

        if (horizontal) {
          config.options.indexAxis = "y";
          config.options.scales.x.beginAtZero = true;
          config.options.scales.y.ticks.autoSkip = false;
        }

        charts[canvasId] = new Chart(ctx, config);
      }

      function exportSummary() {
        const summary = `
    B√ÅOC√ÅO T√ìM T·∫ÆT KH·∫¢O S√ÅT
    Ph√°t tri·ªÉn s·∫£n ph·∫©m du l·ªãch n√¥ng nghi·ªáp tr·∫£i nghi·ªám t·∫°i L√†ng hoa Sa ƒê√©c, t·ªânh ƒê·ªìng Th√°p

    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    üìä T·ªîNG QUAN
    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    ‚Ä¢ T·ªïng s·ªë ph·∫£n h·ªìi: ${document.getElementById("totalResponses").textContent}
    ‚Ä¢ Nh√≥m tu·ªïi ph·ªï bi·∫øn: ${
      document.getElementById("popularAgeGroup").textContent
    }
    ‚Ä¢ T·ª∑ l·ªá h√†i l√≤ng: ${document.getElementById("satisfactionRate").textContent}
    ‚Ä¢ S·∫µn s√†ng quay l·∫°i: ${document.getElementById("returnRate").textContent}

    üìà NH·ªÆNG PH√ÅT HI·ªÜN CH√çNH
    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    ‚Ä¢ Quan t√¢m tr·∫£i nghi·ªám n√¥ng nghi·ªáp: ${
      document.getElementById("expInterestPercent").textContent
    }
    ‚Ä¢ S·∫µn s√†ng gi·ªõi thi·ªáu b·∫°n b√®: ${
      document.getElementById("referralPercent").textContent
    }
    ‚Ä¢ M·ª©c gi√° ch·∫•p nh·∫≠n (trung b√¨nh): ${
      document.getElementById("avgPrice").textContent
    }

    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    üéØ K·∫æT LU·∫¨N V√Ä KHUY·∫æN NGH·ªä

    D·ª±a tr√™n k·∫øt qu·∫£ kh·∫£o s√°t, c√≥ th·ªÉ th·∫•y:

    1. M·ª®C ƒê·ªò QUAN T√ÇM: Du kh√°ch c√≥ m·ª©c ƒë·ªô quan t√¢m cao ƒë·∫øn c√°c ho·∫°t ƒë·ªông
       tr·∫£i nghi·ªám n√¥ng nghi·ªáp t·∫°i L√†ng hoa Sa ƒê√©c.

    2. TI·ªÄM NƒÇNG PH√ÅT TRI·ªÇN: V·ªõi t·ª∑ l·ªá h√†i l√≤ng v√† d·ª± ƒë·ªãnh quay l·∫°i cao,
       ƒë√¢y l√† c∆° h·ªôi t·ªët ƒë·ªÉ ph√°t tri·ªÉn c√°c s·∫£n ph·∫©m du l·ªãch tr·∫£i nghi·ªám.

    3. M·ª®C GI√Å H·ª¢P L√ù: Du kh√°ch s·∫µn s√†ng chi tr·∫£ v·ªõi m·ª©c gi√° trung b√¨nh
       ph√π h·ª£p cho c√°c g√≥i tr·∫£i nghi·ªám 2-3 ti·∫øng.

    4. ƒê·ªÄ XU·∫§T PH√ÅT TRI·ªÇN:
       - ƒêa d·∫°ng h√≥a c√°c ho·∫°t ƒë·ªông tr·∫£i nghi·ªám
       - C·∫£i thi·ªán c∆° s·ªü h·∫° t·∫ßng v√† d·ªãch v·ª•
       - TƒÉng c∆∞·ªùng ƒë√†o t·∫°o nh√¢n vi√™n v√† n√¥ng d√¢n ƒë·ªãa ph∆∞∆°ng
       - Qu·∫£ng b√° r·ªông r√£i tr√™n c√°c k√™nh truy·ªÅn th√¥ng

    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    B√°o c√°o ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông t·ª´ Dashboard Ph√¢n T√≠ch Kh·∫£o S√°t
    Tr∆∞·ªùng ƒê·∫°i h·ªçc C√¥ng Nghi·ªáp TP.HCM - Khoa Th∆∞∆°ng m·∫°i - Du l·ªãch
    Ng√†y xu·∫•t: ${new Date().toLocaleDateString("vi-VN")}
        `;

        const blob = new Blob([summary], { type: "text/plain;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "Bao_Cao_Tom_Tat_Khao_Sat_Lang_Hoa_Sa_Dec.txt";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert("‚úÖ ƒê√£ xu·∫•t b√°o c√°o t√≥m t·∫Øt th√†nh c√¥ng!");
      }
    </script>
  </body>
</html>
